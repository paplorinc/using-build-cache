<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Using the Build Cache</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">

<link crossorigin href="//assets.gradle.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet">
<link rel="stylesheet" href="https://guides.gradle.org/css/docs-blue-theme-4.10.css">
<link rel="apple-touch-icon" sizes="180x180" href="https://guides.gradle.org/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://guides.gradle.org/icon/manifest.json">
<link rel="shortcut icon" href="https://guides.gradle.org/icon/favicon.ico">
<script defer src="https://guides.gradle.org/js/guides-4.10.js"></script>
<script defer src="https://guides.gradle.org/js/set-time-to-complete-text.js"></script>
<script async src="https://guides.gradle.org/js/autotrack.js"></script>

</head>
<body class="article">
<header class="site-layout__header site-header js-site-header" itemscope="itemscope" itemtype="https://schema.org/WPHeader">
    <nav class="site-header__navigation" itemscope="itemscope" itemtype="https://schema.org/SiteNavigationElement">
        <div class="site-header__navigation-header">
            <a target="_top" class="logo" href="https://guides.gradle.org" title="Gradle Docs">
                <svg width="179px" height="36px" viewBox="0 0 214 43" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <path d="M46.8764467,7.88772959 C45.3200364,5.08928963 42.538267,4.25293158 40.5730047,4.21328173 C38.1617855,4.16464717 36.1814618,5.49994885 36.5560017,6.37654271 C36.6363956,6.56473304 37.0884369,7.5470924 37.3659256,7.95257566 C37.767596,8.5393154 38.4866528,8.08851802 38.7385072,7.95462652 C39.4905793,7.55490518 40.2943191,7.42550602 41.2059822,7.53175982 C42.0774483,7.63332596 43.2351806,8.17045455 44.0118896,9.6627931 C45.8397043,13.1750281 40.1972679,20.4036071 33.1344723,15.3978616 C26.0715771,10.3921161 19.203283,12.0507692 16.0936541,13.059692 C12.9841249,14.0684195 11.5547888,15.0829089 12.7835391,17.4289889 C14.4533587,20.6171889 13.8998775,19.6389313 15.519027,22.2780882 C18.0908346,26.4697421 23.7203042,20.3491129 23.7203042,20.3491129 C19.526654,26.5308771 15.931769,25.0372689 14.5529036,22.8762541 C13.3102888,20.9285282 12.3447638,18.6830377 12.3447638,18.6830377 C1.72319071,22.4290701 4.5969243,38.9663805 4.5969243,38.9663805 L9.87170315,38.9663805 C11.2165558,32.8772955 16.0248305,33.1018153 16.848918,38.9663805 L20.8738008,38.9663805 C24.4333764,27.0763067 33.4552501,38.9663805 33.4552501,38.9663805 L38.701901,38.9663805 C37.2324677,30.8555435 41.6532357,28.3073078 44.4391943,23.5530361 C47.2254521,18.7983738 49.8646868,12.9818572 46.8764467,7.88772959 L46.8764467,7.88772959 Z M33.3433369,23.5472742 C30.5694474,22.6419684 31.5616042,19.8816157 31.5616042,19.8816157 C31.5616042,19.8816157 33.9840944,20.6649445 37.2609946,21.7341234 C37.0723781,22.5903064 35.4423564,24.232455 33.3433369,23.5472742 L33.3433369,23.5472742 Z" id="Fill-9" fill="#02303A"></path>
                        <path d="M35.8042288,21.4659498 C35.8871163,22.2300396 35.3025149,22.9172712 34.4983762,23.0008679 C33.6942375,23.0844647 32.9752804,22.5327848 32.8923929,21.7685973 C32.8095053,21.0045075 33.3942065,20.3172758 34.1982455,20.2336791 C35.0023842,20.1500824 35.721441,20.7017623 35.8042288,21.4659498" id="Fill-10" fill="#00303A"></path>
                        <path d="M72.236,22.3 L72.236,29.32 C71.3559956,29.9680032 70.418005,30.4419985 69.422,30.742 C68.425995,31.0420015 67.3600057,31.192 66.224,31.192 C64.8079929,31.192 63.5260057,30.9720022 62.378,30.532 C61.2299943,30.0919978 60.2500041,29.4800039 59.438,28.696 C58.6259959,27.9119961 58.0000022,26.9760054 57.56,25.888 C57.1199978,24.7999946 56.9,23.6120064 56.9,22.324 C56.9,21.0199935 57.1119979,19.8240054 57.536,18.736 C57.9600021,17.6479946 58.5619961,16.7120039 59.342,15.928 C60.1220039,15.1439961 61.0679944,14.5360022 62.18,14.104 C63.2920056,13.6719978 64.5399931,13.456 65.924,13.456 C66.6280035,13.456 67.2859969,13.5119994 67.898,13.624 C68.5100031,13.7360006 69.0779974,13.889999 69.602,14.086 C70.1260026,14.282001 70.6039978,14.5199986 71.036,14.8 C71.4680022,15.0800014 71.8639982,15.3879983 72.224,15.724 L71.3,17.188 C71.1559993,17.4200012 70.9680012,17.5619997 70.736,17.614 C70.5039988,17.6660003 70.2520014,17.6080008 69.98,17.44 L69.188,16.984 C68.9239987,16.8319992 68.6300016,16.7000006 68.306,16.588 C67.9819984,16.4759994 67.618002,16.3840004 67.214,16.312 C66.809998,16.2399996 66.3440026,16.204 65.816,16.204 C64.9599957,16.204 64.1860035,16.3479986 63.494,16.636 C62.8019965,16.9240014 62.2120024,17.3359973 61.724,17.872 C61.2359976,18.4080027 60.8600013,19.0519962 60.596,19.804 C60.3319987,20.5560038 60.2,21.3959954 60.2,22.324 C60.2,23.316005 60.3419986,24.2019961 60.626,24.982 C60.9100014,25.7620039 61.3099974,26.4219973 61.826,26.962 C62.3420026,27.5020027 62.9639964,27.9139986 63.692,28.198 C64.4200036,28.4820014 65.2319955,28.624 66.128,28.624 C66.7680032,28.624 67.3399975,28.5560007 67.844,28.42 C68.3480025,28.2839993 68.8399976,28.1000012 69.32,27.868 L69.32,24.724 L67.136,24.724 C66.927999,24.724 66.7660006,24.6660006 66.65,24.55 C66.5339994,24.4339994 66.476,24.2920008 66.476,24.124 L66.476,22.3 L72.236,22.3 Z M77.504,20.824 C77.8880019,20.0879963 78.3439974,19.5100021 78.872,19.09 C79.4000026,18.6699979 80.0239964,18.46 80.744,18.46 C81.3120028,18.46 81.7679983,18.5839988 82.112,18.832 L81.92,21.052 C81.8799998,21.1960007 81.8220004,21.2979997 81.746,21.358 C81.6699996,21.4180003 81.5680006,21.448 81.44,21.448 C81.3199994,21.448 81.1420012,21.4280002 80.906,21.388 C80.6699988,21.3479998 80.4400011,21.328 80.216,21.328 C79.8879984,21.328 79.5960013,21.3759995 79.34,21.472 C79.0839987,21.5680005 78.854001,21.7059991 78.65,21.886 C78.445999,22.0660009 78.2660008,22.2839987 78.11,22.54 C77.9539992,22.7960013 77.8080007,23.0879984 77.672,23.416 L77.672,31 L74.708,31 L74.708,18.688 L76.448,18.688 C76.7520015,18.688 76.9639994,18.7419995 77.084,18.85 C77.2040006,18.9580005 77.2839998,19.1519986 77.324,19.432 L77.504,20.824 Z M90.008,25.744 C89.1519957,25.7840002 88.4320029,25.8579995 87.848,25.966 C87.2639971,26.0740005 86.7960018,26.2119992 86.444,26.38 C86.0919982,26.5480008 85.8400008,26.7439989 85.688,26.968 C85.5359992,27.1920011 85.46,27.4359987 85.46,27.7 C85.46,28.2200026 85.6139985,28.5919989 85.922,28.816 C86.2300015,29.0400011 86.6319975,29.152 87.128,29.152 C87.736003,29.152 88.2619978,29.0420011 88.706,28.822 C89.1500022,28.6019989 89.5839979,28.2680022 90.008,27.82 L90.008,25.744 Z M83.216,20.404 C84.6320071,19.1079935 86.33599,18.46 88.328,18.46 C89.0480036,18.46 89.6919972,18.5779988 90.26,18.814 C90.8280028,19.0500012 91.307998,19.3779979 91.7,19.798 C92.092002,20.2180021 92.389999,20.7199971 92.594,21.304 C92.798001,21.8880029 92.9,22.5279965 92.9,23.224 L92.9,31 L91.556,31 C91.2759986,31 91.0600008,30.9580004 90.908,30.874 C90.7559992,30.7899996 90.6360004,30.6200013 90.548,30.364 L90.284,29.476 C89.9719984,29.7560014 89.6680015,30.0019989 89.372,30.214 C89.0759985,30.4260011 88.7680016,30.6039993 88.448,30.748 C88.1279984,30.8920007 87.7860018,31.0019996 87.422,31.078 C87.0579982,31.1540004 86.6560022,31.192 86.216,31.192 C85.6959974,31.192 85.2160022,31.1220007 84.776,30.982 C84.3359978,30.8419993 83.9560016,30.6320014 83.636,30.352 C83.3159984,30.0719986 83.0680009,29.7240021 82.892,29.308 C82.7159991,28.8919979 82.628,28.4080028 82.628,27.856 C82.628,27.5439984 82.6799995,27.2340015 82.784,26.926 C82.8880005,26.6179985 83.0579988,26.3240014 83.294,26.044 C83.5300012,25.7639986 83.8359981,25.5000012 84.212,25.252 C84.5880019,25.0039988 85.0499973,24.7880009 85.598,24.604 C86.1460027,24.4199991 86.7839964,24.2700006 87.512,24.154 C88.2400036,24.0379994 89.0719953,23.9680001 90.008,23.944 L90.008,23.224 C90.008,22.3999959 89.8320018,21.790002 89.48,21.394 C89.1279982,20.997998 88.6200033,20.8 87.956,20.8 C87.4759976,20.8 87.0780016,20.8559994 86.762,20.968 C86.4459984,21.0800006 86.1680012,21.2059993 85.928,21.346 C85.6879988,21.4860007 85.470001,21.6119994 85.274,21.724 C85.077999,21.8360006 84.8600012,21.892 84.62,21.892 C84.411999,21.892 84.2360007,21.8380005 84.092,21.73 C83.9479993,21.6219995 83.8320004,21.4960007 83.744,21.352 L83.216,20.404 Z M103.412,21.832 C103.075998,21.423998 102.710002,21.1360008 102.314,20.968 C101.917998,20.7999992 101.492002,20.716 101.036,20.716 C100.587998,20.716 100.184002,20.7999992 99.824,20.968 C99.4639982,21.1360008 99.1560013,21.3899983 98.9,21.73 C98.6439987,22.0700017 98.4480007,22.5019974 98.312,23.026 C98.1759993,23.5500026 98.108,24.1679964 98.108,24.88 C98.108,25.6000036 98.1659994,26.2099975 98.282,26.71 C98.3980006,27.2100025 98.5639989,27.6179984 98.78,27.934 C98.9960011,28.2500016 99.2599984,28.4779993 99.572,28.618 C99.8840016,28.7580007 100.231998,28.828 100.616,28.828 C101.232003,28.828 101.755998,28.7000013 102.188,28.444 C102.620002,28.1879987 103.027998,27.8240024 103.412,27.352 L103.412,21.832 Z M106.376,13.168 L106.376,31 L104.564,31 C104.171998,31 103.924001,30.8200018 103.82,30.46 L103.568,29.272 C103.071998,29.8400028 102.502003,30.2999982 101.858,30.652 C101.213997,31.0040018 100.464004,31.18 99.608,31.18 C98.9359966,31.18 98.3200028,31.0400014 97.76,30.76 C97.1999972,30.4799986 96.718002,30.0740027 96.314,29.542 C95.909998,29.0099973 95.5980011,28.3520039 95.378,27.568 C95.1579989,26.7839961 95.048,25.888005 95.048,24.88 C95.048,23.9679954 95.1719988,23.1200039 95.42,22.336 C95.6680012,21.5519961 96.0239977,20.8720029 96.488,20.296 C96.9520023,19.7199971 97.5079968,19.2700016 98.156,18.946 C98.8040032,18.6219984 99.531996,18.46 100.34,18.46 C101.028003,18.46 101.615998,18.5679989 102.104,18.784 C102.592002,19.0000011 103.027998,19.2919982 103.412,19.66 L103.412,13.168 L106.376,13.168 Z M112.304,13.168 L112.304,31 L109.34,31 L109.34,13.168 L112.304,13.168 Z M123.2,23.428 C123.2,23.0439981 123.146001,22.6820017 123.038,22.342 C122.929999,22.0019983 122.768001,21.7040013 122.552,21.448 C122.335999,21.1919987 122.062002,20.9900007 121.73,20.842 C121.397998,20.6939993 121.012002,20.62 120.572,20.62 C119.715996,20.62 119.042002,20.8639976 118.55,21.352 C118.057998,21.8400024 117.744001,22.5319955 117.608,23.428 L123.2,23.428 Z M117.548,25.216 C117.596,25.8480032 117.707999,26.3939977 117.884,26.854 C118.060001,27.3140023 118.291999,27.6939985 118.58,27.994 C118.868001,28.2940015 119.209998,28.5179993 119.606,28.666 C120.002002,28.8140007 120.439998,28.888 120.92,28.888 C121.400002,28.888 121.813998,28.8320006 122.162,28.72 C122.510002,28.6079994 122.813999,28.4840007 123.074,28.348 C123.334001,28.2119993 123.561999,28.0880006 123.758,27.976 C123.954001,27.8639994 124.143999,27.808 124.328,27.808 C124.576001,27.808 124.759999,27.8999991 124.88,28.084 L125.732,29.164 C125.403998,29.5480019 125.036002,29.8699987 124.628,30.13 C124.219998,30.3900013 123.794002,30.5979992 123.35,30.754 C122.905998,30.9100008 122.454002,31.0199997 121.994,31.084 C121.533998,31.1480003 121.088002,31.18 120.656,31.18 C119.799996,31.18 119.004004,31.0380014 118.268,30.754 C117.531996,30.4699986 116.892003,30.0500028 116.348,29.494 C115.803997,28.9379972 115.376002,28.2500041 115.064,27.43 C114.751998,26.6099959 114.596,25.6600054 114.596,24.58 C114.596,23.7399958 114.731999,22.9500037 115.004,22.21 C115.276001,21.4699963 115.665997,20.8260027 116.174,20.278 C116.682003,19.7299973 117.301996,19.2960016 118.034,18.976 C118.766004,18.6559984 119.591995,18.496 120.512,18.496 C121.288004,18.496 122.003997,18.6199988 122.66,18.868 C123.316003,19.1160012 123.879998,19.4779976 124.352,19.954 C124.824002,20.4300024 125.193999,21.0139965 125.462,21.706 C125.730001,22.3980035 125.864,23.1879956 125.864,24.076 C125.864,24.5240022 125.816,24.8259992 125.72,24.982 C125.624,25.1380008 125.440001,25.216 125.168,25.216 L117.548,25.216 Z M148.832,23.296 L148.832,29.332 C147.983996,29.932003 147.080005,30.3919984 146.12,30.712 C145.159995,31.0320016 144.080006,31.192 142.88,31.192 C141.535993,31.192 140.328005,30.9860021 139.256,30.574 C138.183995,30.1619979 137.270004,29.5780038 136.514,28.822 C135.757996,28.0659962 135.178002,27.1520054 134.774,26.08 C134.369998,25.0079946 134.168,23.8160066 134.168,22.504 C134.168,21.1919934 134.365998,20.0020053 134.762,18.934 C135.158002,17.8659947 135.725996,16.9540038 136.466,16.198 C137.206004,15.4419962 138.099995,14.8580021 139.148,14.446 C140.196005,14.0339979 141.375993,13.828 142.688,13.828 C143.336003,13.828 143.933997,13.8719996 144.482,13.96 C145.030003,14.0480004 145.539998,14.1779991 146.012,14.35 C146.484002,14.5220009 146.923998,14.7339987 147.332,14.986 C147.740002,15.2380013 148.131998,15.5279984 148.508,15.856 L148.172,16.384 C148.059999,16.576001 147.892001,16.6200005 147.668,16.516 C147.547999,16.4679998 147.376001,16.3560009 147.152,16.18 C146.927999,16.0039991 146.620002,15.820001 146.228,15.628 C145.835998,15.435999 145.350003,15.2640008 144.77,15.112 C144.189997,14.9599992 143.484004,14.884 142.652,14.884 C141.547994,14.884 140.550004,15.0599982 139.658,15.412 C138.765996,15.7640018 138.006003,16.2679967 137.378,16.924 C136.749997,17.5800033 136.266002,18.3799953 135.926,19.324 C135.585998,20.2680047 135.416,21.3279941 135.416,22.504 C135.416,23.696006 135.585998,24.7679952 135.926,25.72 C136.266002,26.6720048 136.757997,27.4799967 137.402,28.144 C138.046003,28.8080033 138.827995,29.3159982 139.748,29.668 C140.668005,30.0200018 141.703994,30.196 142.856,30.196 C143.360003,30.196 143.825998,30.1640003 144.254,30.1 C144.682002,30.0359997 145.089998,29.9460006 145.478,29.83 C145.866002,29.7139994 146.241998,29.5700009 146.606,29.398 C146.970002,29.2259991 147.339998,29.0320011 147.716,28.816 L147.716,24.244 L144.464,24.244 C144.376,24.244 144.302,24.2160003 144.242,24.16 C144.182,24.1039997 144.152,24.0400004 144.152,23.968 L144.152,23.296 L148.832,23.296 Z M161.408,19.06 L161.408,31 L160.772,31 C160.571999,31 160.456,30.896001 160.424,30.688 L160.316,28.912 C159.763997,29.6000034 159.126004,30.1519979 158.402,30.568 C157.677996,30.9840021 156.872004,31.192 155.984,31.192 C155.319997,31.192 154.740002,31.088001 154.244,30.88 C153.747998,30.671999 153.336002,30.372002 153.008,29.98 C152.679998,29.587998 152.432001,29.1160028 152.264,28.564 C152.095999,28.0119972 152.012,27.3880035 152.012,26.692 L152.012,19.06 L153.164,19.06 L153.164,26.692 C153.164,27.8120056 153.419997,28.6899968 153.932,29.326 C154.444003,29.9620032 155.223995,30.28 156.272,30.28 C157.048004,30.28 157.773997,30.082002 158.45,29.686 C159.126003,29.289998 159.727997,28.7400035 160.256,28.036 L160.256,19.06 L161.408,19.06 Z M166.604,19.06 L166.604,31 L165.464,31 L165.464,19.06 L166.604,19.06 Z M167.096,14.944 C167.096,15.0880007 167.066,15.2219994 167.006,15.346 C166.946,15.4700006 166.868,15.5799995 166.772,15.676 C166.676,15.7720005 166.564001,15.8479997 166.436,15.904 C166.307999,15.9600003 166.172001,15.988 166.028,15.988 C165.883999,15.988 165.748001,15.9600003 165.62,15.904 C165.491999,15.8479997 165.38,15.7720005 165.284,15.676 C165.188,15.5799995 165.112,15.4700006 165.056,15.346 C165,15.2219994 164.972,15.0880007 164.972,14.944 C164.972,14.7999993 165,14.6620007 165.056,14.53 C165.112,14.3979993 165.188,14.2840005 165.284,14.188 C165.38,14.0919995 165.491999,14.0160003 165.62,13.96 C165.748001,13.9039997 165.883999,13.876 166.028,13.876 C166.172001,13.876 166.307999,13.9039997 166.436,13.96 C166.564001,14.0160003 166.676,14.0919995 166.772,14.188 C166.868,14.2840005 166.946,14.3979993 167.006,14.53 C167.066,14.6620007 167.096,14.7999993 167.096,14.944 Z M178.82,21.628 C178.363998,20.9399966 177.858003,20.4560014 177.302,20.176 C176.745997,19.8959986 176.112004,19.756 175.4,19.756 C174.695996,19.756 174.080003,19.8839987 173.552,20.14 C173.023997,20.3960013 172.582002,20.7579977 172.226,21.226 C171.869998,21.6940023 171.602001,22.2539967 171.422,22.906 C171.241999,23.5580033 171.152,24.2759961 171.152,25.06 C171.152,26.8360089 171.477997,28.1419958 172.13,28.978 C172.782003,29.8140042 173.723994,30.232 174.956,30.232 C175.740004,30.232 176.455997,30.028002 177.104,29.62 C177.752003,29.211998 178.323998,28.6400037 178.82,27.904 L178.82,21.628 Z M179.96,13.54 L179.96,31 L179.336,31 C179.127999,31 179.008,30.896001 178.976,30.688 L178.856,28.804 C178.327997,29.5240036 177.712004,30.0959979 177.008,30.52 C176.303996,30.9440021 175.512004,31.156 174.632,31.156 C173.159993,31.156 172.016004,30.6480051 171.2,29.632 C170.383996,28.6159949 169.976,27.0920102 169.976,25.06 C169.976,24.1879956 170.089999,23.3740038 170.318,22.618 C170.546001,21.8619962 170.879998,21.2060028 171.32,20.65 C171.760002,20.0939972 172.301997,19.6560016 172.946,19.336 C173.590003,19.0159984 174.331996,18.856 175.172,18.856 C175.980004,18.856 176.679997,19.0039985 177.272,19.3 C177.864003,19.5960015 178.379998,20.0359971 178.82,20.62 L178.82,13.54 L179.96,13.54 Z M192.272,23.824 C192.272,23.1839968 192.182001,22.6100025 192.002,22.102 C191.821999,21.5939975 191.568002,21.1640018 191.24,20.812 C190.911998,20.4599982 190.522002,20.1900009 190.07,20.002 C189.617998,19.8139991 189.120003,19.72 188.576,19.72 C187.959997,19.72 187.408002,19.815999 186.92,20.008 C186.431998,20.200001 186.010002,20.4759982 185.654,20.836 C185.297998,21.1960018 185.012001,21.6279975 184.796,22.132 C184.579999,22.6360025 184.436,23.1999969 184.364,23.824 L192.272,23.824 Z M184.304,24.556 L184.304,24.784 C184.304,25.6800045 184.407999,26.4679966 184.616,27.148 C184.824001,27.8280034 185.119998,28.3979977 185.504,28.858 C185.888002,29.3180023 186.351997,29.6639988 186.896,29.896 C187.440003,30.1280012 188.047997,30.244 188.72,30.244 C189.320003,30.244 189.839998,30.1780007 190.28,30.046 C190.720002,29.9139993 191.089999,29.7660008 191.39,29.602 C191.690002,29.4379992 191.927999,29.2900007 192.104,29.158 C192.280001,29.0259993 192.408,28.96 192.488,28.96 C192.592001,28.96 192.672,28.9999996 192.728,29.08 L193.04,29.464 C192.847999,29.7040012 192.594002,29.927999 192.278,30.136 C191.961998,30.344001 191.610002,30.5219993 191.222,30.67 C190.833998,30.8180007 190.418002,30.9359996 189.974,31.024 C189.529998,31.1120004 189.084002,31.156 188.636,31.156 C187.819996,31.156 187.076003,31.0140014 186.404,30.73 C185.731997,30.4459986 185.156002,30.0320027 184.676,29.488 C184.195998,28.9439973 183.826001,28.2780039 183.566,27.49 C183.305999,26.7019961 183.176,25.8000051 183.176,24.784 C183.176,23.9279957 183.297999,23.1380036 183.542,22.414 C183.786001,21.6899964 184.137998,21.0660026 184.598,20.542 C185.058002,20.0179974 185.621997,19.6080015 186.29,19.312 C186.958003,19.0159985 187.715996,18.868 188.564,18.868 C189.236003,18.868 189.859997,18.9839988 190.436,19.216 C191.012003,19.4480012 191.511998,19.7859978 191.936,20.23 C192.360002,20.6740022 192.693999,21.2199968 192.938,21.868 C193.182001,22.5160032 193.304,23.2599958 193.304,24.1 C193.304,24.2760009 193.28,24.3959997 193.232,24.46 C193.184,24.5240003 193.104001,24.556 192.992,24.556 L184.304,24.556 Z M202.976,20.536 C202.912,20.6480006 202.820001,20.704 202.7,20.704 C202.612,20.704 202.500001,20.6540005 202.364,20.554 C202.227999,20.4539995 202.046001,20.3420006 201.818,20.218 C201.589999,20.0939994 201.308002,19.9820005 200.972,19.882 C200.635998,19.7819995 200.228002,19.732 199.748,19.732 C199.315998,19.732 198.922002,19.7939994 198.566,19.918 C198.209998,20.0420006 197.906001,20.207999 197.654,20.416 C197.401999,20.624001 197.208001,20.8659986 197.072,21.142 C196.935999,21.4180014 196.868,21.7079985 196.868,22.012 C196.868,22.3880019 196.963999,22.6999988 197.156,22.948 C197.348001,23.1960012 197.597998,23.4079991 197.906,23.584 C198.214002,23.7600009 198.567998,23.9119994 198.968,24.04 C199.368002,24.1680006 199.773998,24.2959994 200.186,24.424 C200.598002,24.5520006 201.003998,24.6939992 201.404,24.85 C201.804002,25.0060008 202.157998,25.1999988 202.466,25.432 C202.774002,25.6640012 203.023999,25.9479983 203.216,26.284 C203.408001,26.6200017 203.504,27.0279976 203.504,27.508 C203.504,28.0280026 203.412001,28.5119978 203.228,28.96 C203.043999,29.4080022 202.774002,29.7959984 202.418,30.124 C202.061998,30.4520016 201.624003,30.711999 201.104,30.904 C200.583997,31.096001 199.988003,31.192 199.316,31.192 C198.475996,31.192 197.752003,31.0580013 197.144,30.79 C196.535997,30.5219987 195.992002,30.1720022 195.512,29.74 L195.776,29.332 C195.816,29.2679997 195.862,29.2200002 195.914,29.188 C195.966,29.1559998 196.036,29.14 196.124,29.14 C196.228001,29.14 196.353999,29.2039994 196.502,29.332 C196.650001,29.4600006 196.847999,29.5979993 197.096,29.746 C197.344001,29.8940007 197.649998,30.0319994 198.014,30.16 C198.378002,30.2880006 198.827997,30.352 199.364,30.352 C199.868003,30.352 200.311998,30.2820007 200.696,30.142 C201.080002,30.0019993 201.399999,29.8120012 201.656,29.572 C201.912001,29.3319988 202.105999,29.0500016 202.238,28.726 C202.370001,28.4019984 202.436,28.0600018 202.436,27.7 C202.436,27.299998 202.340001,26.9680013 202.148,26.704 C201.955999,26.4399987 201.704002,26.2160009 201.392,26.032 C201.079998,25.8479991 200.726002,25.6920006 200.33,25.564 C199.933998,25.4359994 199.528002,25.3080006 199.112,25.18 C198.695998,25.0519994 198.290002,24.9120008 197.894,24.76 C197.497998,24.6079992 197.144002,24.4160012 196.832,24.184 C196.519998,23.9519988 196.268001,23.6700017 196.076,23.338 C195.883999,23.0059983 195.788,22.5920025 195.788,22.096 C195.788,21.6719979 195.879999,21.264002 196.064,20.872 C196.248001,20.479998 196.509998,20.1360015 196.85,19.84 C197.190002,19.5439985 197.603998,19.3080009 198.092,19.132 C198.580002,18.9559991 199.127997,18.868 199.736,18.868 C200.464004,18.868 201.109997,18.971999 201.674,19.18 C202.238003,19.388001 202.751998,19.7079978 203.216,20.14 L202.976,20.536 Z" fill="#02303A"></path>
                    </g>
                </svg>
            </a>
            <div class="site-header__doc-type sr-only">Guides</div>
            <div class="site-header-version js-site-header-version"></div>
            <button type="button" aria-label="Navigation Menu" class="site-header__navigation-button hamburger">
                <span class="hamburger__bar"></span>
                <span class="hamburger__bar"></span>
                <span class="hamburger__bar"></span>
            </button>
        </div>
        <div class="site-header__navigation-collapsible site-header__navigation-collapsible--collapse">
            <ul class="site-header__navigation-items">
                <li class="site-header__navigation-item site-header__navigation-submenu-section" tabindex="0">
                    <span class="site-header__navigation-link">
                    Community
                    <svg class="site-header__down-arrow site-header__icon-light" width="19" height="11" viewBox="0 0 19 11" xmlns="http://www.w3.org/2000/svg"><title>Open Community Menu</title><path transform="rotate(-180 9.374 5.494)" d="M17.9991 10.422825L9.3741 0.565575 0.7491 10.422825" stroke="#02303A" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    </span>
                    <div class="site-header__navigation-submenu">
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://gradle.org/" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Community Home</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://discuss.gradle.org/" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Community Forums</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a target="_top" class="site-header__navigation-submenu-item-link" href="https://plugins.gradle.org" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Community Plugins</span>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="site-header__navigation-item" itemprop="name">
                    <a target="_top" class="site-header__navigation-link" href="https://gradle.org/training/" itemprop="url">Training</a>
                </li>
                <li class="site-header__navigation-item site-header__navigation-submenu-section" tabindex="0">
                    <span class="site-header__navigation-link">
                    News
                    <svg class="site-header__down-arrow site-header__icon-light" width="19" height="11" viewBox="0 0 19 11" xmlns="http://www.w3.org/2000/svg"><title>Open Community Menu</title><path transform="rotate(-180 9.374 5.494)" d="M17.9991 10.422825L9.3741 0.565575 0.7491 10.422825" stroke="#02303A" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    </span>
                    <div class="site-header__navigation-submenu">
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a class="site-header__navigation-submenu-item-link" href="https://newsletter.gradle.com" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Newsletter</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item" itemprop="name">
                            <a class="site-header__navigation-submenu-item-link" href="https://blog.gradle.org" itemprop="url">
                                <span class="site-header__navigation-submenu-item-link-text">Blog</span>
                            </a>
                        </div>
                        <div class="site-header__navigation-submenu-item">
                            <a class="site-header__navigation-submenu-item-link" href="https://twitter.com/gradle">
                                <span class="site-header__navigation-submenu-item-link-text">Twitter</span>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="site-header__navigation-item" itemprop="name">
                    <a target="_top" class="site-header__navigation-link" href="https://gradle.com/enterprise" itemprop="url">Enterprise</a>
                </li>
                <li class="site-header__navigation-item">
                    <a class="site-header__navigation-link" title="Gradle on GitHub" href="https://github.com/gradle/gradle">
                        <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <title>github</title>
                            <path d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.268 2.75 1.026A9.578 9.578 0 0 1 10 4.836c.85.004 1.705.114 2.504.337 1.909-1.294 2.747-1.026 2.747-1.026.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.579.688.481C17.137 18.163 20 14.418 20 10c0-5.523-4.478-10-10-10" fill="#02303A" fill-rule="evenodd"></path>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<main class="main-content">
    <nav class="docs-navigation">
        <ul>
            <li><a href="https://docs.gradle.org/current/userguide/userguide.html">User Manual</a></li>
            <li><a href="https://guides.gradle.org">Tutorials</a></li>
            <li><a href="https://docs.gradle.org/current/dsl/">DSL Reference</a></li>
        </ul>

        <h3 id="getting-started">Getting Started</h3>
        <ul>
            <li><a href="https://guides.gradle.org/creating-new-gradle-builds/">Creating New Gradle Builds</a></li>
            <li><a href="https://guides.gradle.org/creating-build-scans/">Creating Build Scans</a></li>
            <li><a href="https://guides.gradle.org/migrating-from-maven/">Migrating From Maven</a></li>
        </ul>

        <h3 id="tutorials">Project Tutorials</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-cpp-projects" aria-expanded="false" aria-controls="building-cpp-projects">C++</a>
                <ul id="building-cpp-projects">
                    <li><a href="https://guides.gradle.org/building-cpp-executables/">Building C++ Executables</a></li>
                    <li><a href="https://guides.gradle.org/building-cpp-libraries/">Building C++ Libraries</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-groovy-projects" aria-expanded="false" aria-controls="building-groovy-projects">Groovy</a>
                <ul id="building-groovy-projects">
                    <li><a href="https://guides.gradle.org/building-groovy-libraries/">Building Groovy Libraries</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-java-projects" aria-expanded="false" aria-controls="building-java-projects">Java</a>
                <ul id="building-java-projects">
                    <li><a href="https://guides.gradle.org/building-java-applications/">Building Java Applications</a></li>
                    <li><a href="https://guides.gradle.org/building-java-libraries/">Building Java Libraries</a></li>
                    <li><a href="https://guides.gradle.org/building-java-9-modules/">Building Java 9 Modules</a></li>
                    <li><a href="https://guides.gradle.org/building-java-web-applications/">Building Java Web Applications</a></li>
                    <li><a href="https://guides.gradle.org/building-spring-boot-2-projects-with-gradle/">Building Spring Boot 2.x Applications</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-javascript-projects" aria-expanded="false" aria-controls="building-javascript-projects">JavaScript</a>
                <ul id="building-javascript-projects">
                    <li><a href="https://guides.gradle.org/running-webpack-with-gradle/">Running Webpack with Gradle</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-kotlin-projects" aria-expanded="false" aria-controls="building-kotlin-projects">Kotlin</a>
                <ul id="building-kotlin-projects">
                    <li><a href="https://guides.gradle.org/building-kotlin-jvm-libraries/">Building Kotlin JVM Libraries</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-scala-projects" aria-expanded="false" aria-controls="building-scala-projects">Scala</a>
                <ul id="building-scala-projects">
                    <li><a href="https://guides.gradle.org/building-scala-libraries/">Building Scala Libraries</a></li>
                </ul>
            </li>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#building-spring-projects" aria-expanded="false" aria-controls="building-spring-projects">Spring</a>
                <ul id="building-spring-projects">
                    <li><a href="https://guides.gradle.org/building-spring-boot-2-projects-with-gradle/">Building Spring Boot 2 Applications with Gradle</a></li>
                </ul>
            </li>
        </ul>

        <h3 id="integrating-gradle">Integrating Gradle</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#ci-integration" aria-expanded="false" aria-controls="ci-integration">Continuous Integration</a>
                <ul id="ci-integration">
                    <li><a href="https://guides.gradle.org/executing-gradle-builds-on-jenkins/">Using Gradle with Jenkins</a></li>
                    <li><a href="https://guides.gradle.org/executing-gradle-builds-on-teamcity/">Using Gradle with TeamCity</a></li>
                    <li><a href="https://guides.gradle.org/executing-gradle-builds-on-travisci/">Using Gradle with Travis CI</a></li>
                </ul>
            </li>
        </ul>

        <h3 id="developing-gradle-plugins">Extending Gradle</h3>
        <ul>
            <li><a class="nav-dropdown" data-toggle="collapse" href="#plugins-tutorials" aria-expanded="false" aria-controls="plugins-tutorials">Plugin Development Guides</a>
                <ul id="plugins-tutorials">
                    <li><a href="https://guides.gradle.org/designing-gradle-plugins/">Designing Gradle Plugins</a></li>
                    <li><a href="https://guides.gradle.org/implementing-gradle-plugins/">Implementing Gradle Plugins</a></li>
                    <li><a href="https://guides.gradle.org/testing-gradle-plugins/">Testing Gradle Plugins</a></li>
                    <li><a href="https://guides.gradle.org/publishing-plugins-to-gradle-plugin-portal/">Publishing Gradle Plugins</a></li>
                </ul>
            </li>
            <li><a href="https://guides.gradle.org/using-the-worker-api/">Developing Parallel Tasks</a></li>
        </ul>
    </nav>
    <div class="chapter">
<div id="header">
<h1>Using the Build Cache</h1>
<div id="toc" class="toc">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#use_cases_for_the_build_cache">Use cases for the build cache</a></li>
<li><a href="#build_cache_performance">Build cache performance</a></li>
<li><a href="#important_concepts">Important concepts</a></li>
<li><a href="#caching_java_projects">Caching Java projects</a></li>
<li><a href="#caching_android_projects">Caching Android projects</a></li>
<li><a href="#debugging_and_diagnosing_cache_misses">Debugging and diagnosing cache misses</a></li>
<li><a href="#common-problems">Solving common problems</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#help_improve_this_guide">Help improve this guide</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The best way to do work faster is to not do work that doesn’t need doing.
Gradle&#8217;s <a href="https://docs.gradle.org/5.4.1/userguide/more_about_tasks.html#sec:up_to_date_checks">incremental build</a> feature does exactly that by not running a task if its inputs and outputs are equivalent to what they were during its previous execution.
<a href="https://docs.gradle.org/5.4.1/userguide/build_cache.html#sec:task_output_caching">Task output caching</a> extends on this by re-using task outputs produced with the same inputs anytime before, on any machine that is connected to the same build cache backend.</p>
</div>
<div class="paragraph">
<p>This guide covers the different use cases for Gradle’s build cache, from local-only development to caching task outputs across large teams.
Our intended audience is build engineers already familiar with the build cache who are looking to enable it for their existing builds.
This guide will discuss ways to measure the advantages provided by the build cache, methods to improve cache performance, and how to diagnose and fix common problems.
Let’s dive in!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use_cases_for_the_build_cache"><a class="anchor" href="#use_cases_for_the_build_cache"></a><a class="link" href="#use_cases_for_the_build_cache">Use cases for the build cache</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle’s build cache is a versatile feature that can be used in different ways.</p>
</div>
<div class="sect2">
<h3 id="speed_up_developer_builds_with_the_local_cache"><a class="anchor" href="#speed_up_developer_builds_with_the_local_cache"></a><a class="link" href="#speed_up_developer_builds_with_the_local_cache">Speed up developer builds with the local cache</a></h3>
<div class="paragraph">
<p>Even when used by a single developer only, the build cache can be very useful.
Gradle&#8217;s <em>incremental build</em> feature helps to avoid work that is already done, but once you re-execute a task, any previous results are forgotten.
When you are switching branches back and forth, the local results get rebuilt over and over again, even if you are building something that has already been built before.
The build cache remembers the earlier build results, and greatly reduces the need to rebuild things when they have already been built locally.
This can also extend to rebuilding different commits, like when running <code>git bisect</code>.</p>
</div>
<div class="paragraph">
<p>The local cache can also be useful when working with a project that has multiple variants dimensions, as in the case of Android projects. Each variant has a number of tasks associated with it, and some of those task variants, despite having different names, can end up producing the same output. With the local cache enabled, reuse between task variants will happen automatically when applicable.</p>
</div>
</div>
<div class="sect2">
<h3 id="share_results_between_ci_builds"><a class="anchor" href="#share_results_between_ci_builds"></a><a class="link" href="#share_results_between_ci_builds">Share results between CI builds</a></h3>
<div class="paragraph">
<p>The build cache can do more than go back-and-forth in time: it can also bridge physical distance between computers, allowing results generated on one machine to be re-used by another.
A typical first step when introducing the build cache within a team is to enable it for builds running as part of <em>continuous integration</em> only. Using a shared HTTP build cache backend (such as <a href="https://gradle.com/build-cache/">the one provided by Gradle Enterprise</a>) can significantly reduce the work CI agents need to do.
This translates into faster feedback for developers, and less money spent on the CI resources.
Faster builds also mean fewer commits being part of each build, which makes debugging issues more efficient.</p>
</div>
<div class="paragraph">
<p>Beginning with the build cache on CI is a good first step as the environment on CI agents is usually more stable and predictable than developer machines.
This helps to identify any possible issues with the build that may affect cacheability.</p>
</div>
<div class="paragraph">
<p>If you are subject to audit requirements regarding the artifacts you ship to your customers you may need to disable the build cache for certain builds.
Gradle Enterprise may help you with fulfilling these requirements while still using the build cache for all your builds.
It allows you to easily find out which build produced an artifact coming from the build cache via build scans.</p>
</div>
<div class="paragraph screenshot">
<p><span class="image"><img src="images/from-cache-origin.png" alt="from cache origin"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="accelerate_developer_builds_by_reusing_ci_results"><a class="anchor" href="#accelerate_developer_builds_by_reusing_ci_results"></a><a class="link" href="#accelerate_developer_builds_by_reusing_ci_results">Accelerate developer builds by reusing CI results</a></h3>
<div class="paragraph">
<p>When multiple developers work on the same project, they don&#8217;t just need to build their own changes: whenever they pull from version control, they end up having to build each other&#8217;s changes as well.
Whenever a developer is working on something independent of the pulled changes, they can safely reuse outputs already generated on CI.
Say, you&#8217;re working on module "A", and you pull in some changes to module "B" (which does not depend on your module).
If those changes were already built in CI, you can download the task outputs for module "B" from the cache instead of generating them locally.
A typical use case for this is when developers start their day, pull all changes from version control and then run their first build.</p>
</div>
<div class="paragraph">
<p>The changes don&#8217;t need to be completely independent, either; we&#8217;ll take a look at the strategies to reuse results when dependencies are involved in the section about the <a href="#normalization">different forms of normalization</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="combine_remote_results_with_local_caching"><a class="anchor" href="#combine_remote_results_with_local_caching"></a><a class="link" href="#combine_remote_results_with_local_caching">Combine remote results with local caching</a></h3>
<div class="paragraph">
<p>You can utilize both a local and a remote cache for a compound effect.
While loading results from a CI-filled remote cache helps to avoid work needed because of changes by other developers, the local cache can speed up switching branches and doing <code>git bisect</code>.
On CI machines the local cache can act as a mirror of the remote cache, significantly reducing network usage.</p>
</div>
</div>
<div class="sect2">
<h3 id="share_results_between_developers"><a class="anchor" href="#share_results_between_developers"></a><a class="link" href="#share_results_between_developers">Share results between developers</a></h3>
<div class="paragraph">
<p>Allowing developers to upload their results to a shared cache is possible, but not recommended.
Developers can make changes to task inputs or outputs while the task is executing.
They can do this unintentionally and without noticing, for example by making changes in their IDEs while a build is running.
Currently, Gradle has no good way to defend against these changes, and will simply cache whatever is in the output directory once the task is finished.
This again can lead to corrupted results being uploaded to the shared cache.
This recommendation might change when Gradle has added the necessary safeguards against unintentional modification of task inputs and outputs.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to share task output from incremental builds, i.e. non-clean builds, you have to make sure that all cacheable tasks are properly configured and implemented to deal with stale output.
There are for example annotation processors that do not clean up stale files in the corresponding classes/resources directories.
The cache is a great forcing function to fix these problems, which will also make your incremental builds much more reliable.
At the same time, until you have confidence that the incremental build behavior is flawless, only use clean builds to upload content to the cache.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build_cache_performance"><a class="anchor" href="#build_cache_performance"></a><a class="link" href="#build_cache_performance">Build cache performance</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The sole reason to use any build cache is to make builds faster.
But how much faster can you go when using the cache?
Measuring the impact is both important and complicated, as cache performance is determined by many factors.
Performing measurements of the cache&#8217;s impact can validate the extra effort (work, infrastructure) that is required to start using the cache.
These measurements can later serve as baselines for future improvements, and to watch for signs of regressions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Proper configuration and maintenance of a build can improve caching performance in a big way.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="fully_cached_builds"><a class="anchor" href="#fully_cached_builds"></a><a class="link" href="#fully_cached_builds">Fully cached builds</a></h3>
<div class="paragraph">
<p>The most straightforward way to get a feel for what the cache can do for you is to measure the difference between a non-cached build and a <em>fully cached</em> build. This will give you the theoretical limit of how fast builds with the cache can get, if everything you&#8217;re trying to build has already been built. The easiest way to measure this is using the local cache:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clean the cache directory to avoid any hits from previous builds (<code>rm -rf $GRADLE_HOME/caches/build-cache-*</code>)</p>
</li>
<li>
<p>Run the build (e.g. <code>./gradlew --build-cache clean assemble</code>), so that all the results from cacheable tasks get stored in the cache.</p>
</li>
<li>
<p>Run the build again (e.g. <code>./gradlew --build-cache clean assemble</code>); depending on your build, you should see many of the tasks being retrieved from the cache.</p>
</li>
<li>
<p>Compare the execution time for the two builds</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You may encounter a few cached tasks even in the first of the two builds, where no previously cached results should be available.
This can happen if you have tasks in your build that are configured to produce the same results from the same inputs; in such a case once one of these tasks has finished, Gradle will simply reuse its output for the rest of the tasks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Normally, your <em>fully cached</em> build should be significantly faster than the <code>clean</code> build: this is the theoretical limit of how much time using the build cache can save on your particular build.
You usually don&#8217;t get the achievable performance gains on the first try, see <a href="#finding_problems">"Finding problems with task output caching"</a>.
As your build logic is evolving and changing it is also important to make sure that the cache effectiveness is not regressing.
Build scans provide a detailed performance breakdown which show you how effectively your build is using the build cache:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/performance-task-execution.png" alt="performance task execution">
</div>
</div>
<div class="paragraph">
<p>Fully cached builds occur in situations when developers check out the latest from version control and then build, for example to generate the latest sources they need in their IDE.
The purpose of running most builds though is to process some new changes.
The structure of the software being built (how many modules are there, how independent are its parts etc.), and the nature of the changes themselves ("big refactor in the core of the system" vs. "small change to a unit test" etc.) strongly influence the performance gains delivered by the build cache.
As developers tend to submit different kinds of changes over time, caching performance is expected to vary with each change.
As with any cache, the impact should therefore be measured over time.</p>
</div>
<div class="paragraph">
<p>In a setup where a team uses a shared cache backend, there are two locations worth measuring cache impact at: on CI and on developer machines.</p>
</div>
</div>
<div class="sect2">
<h3 id="cache_impact_on_ci_builds"><a class="anchor" href="#cache_impact_on_ci_builds"></a><a class="link" href="#cache_impact_on_ci_builds">Cache impact on CI builds</a></h3>
<div class="paragraph">
<p>The best way to learn about the impact of caching on CI is to set up the same builds with the cache enabled and disabled, and compare the results over time. If you have a single Gradle build step that you want to enable caching for, it&#8217;s easy to compare the results using your CI system&#8217;s built-in statistical tools.</p>
</div>
<div class="paragraph">
<p>Measuring complex pipelines may require more work or external tools to collect and process measurements.
It&#8217;s important to distinguish those parts of the pipeline that caching has no effect on, for example, the time builds spend waiting in the CI system&#8217;s queue, or time taken by checking out source code from version control.</p>
</div>
<div class="paragraph">
<p>When using Gradle Enterprise, you can use the <a href="https://docs.gradle.com/enterprise/export-api/">Export API</a> to access the necessary data and run your analytics.
Gradle Enterprise provides much richer data compared to what can be obtained from CI servers.
For example, you can get insights into the execution of single tasks, how many tasks were retrieved from the cache, how long it took to download from the cache, the properties that were used to calculate the cache key and more.
When using your CI servers built in functions, you can use <a href="https://confluence.jetbrains.com/display/TCD10/Statistic+Charts">statistic charts</a> if you use Teamcity for your CI builds.
Most of time you will end up extracting data from your CI server via the corresponding REST API (see <a href="https://wiki.jenkins-ci.org/display/JENKINS/Remote+access+API">Jenkins remote access API</a> and <a href="https://confluence.jetbrains.com/display/TCD10/REST+API">Teamcity REST API</a>).</p>
</div>
<div class="paragraph">
<p>Typically, CI builds above a certain size include parallel sections to utilize multiple agents. With parallel pipelines you can measure the wall-clock time it takes for a set of changes to go from having been pushed to version control to being built, verified and deployed. The build cache&#8217;s effect in this case can be measured in the reduction of the time developers have to wait for feedback from CI.</p>
</div>
<div class="paragraph">
<p>You can also measure the cumulative time your build agents spent building a changeset, which will give you a sense of the amount of work the CI infrastructure has to exert. The cache&#8217;s effect here is less money spent on CI resources, as you don&#8217;t need as many CI agents to maintain the same number of changes built.</p>
</div>
<div class="paragraph">
<p>If you want to look at the measurement for the Gradle build itself you can have a look at the blog post <a href="https://blog.gradle.org/introducing-gradle-build-cache">Introducing the build cache</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="measuring_developer_builds"><a class="anchor" href="#measuring_developer_builds"></a><a class="link" href="#measuring_developer_builds">Measuring developer builds</a></h3>
<div class="paragraph">
<p>Gradle&#8217;s build cache can be very useful in reducing CI infrastructure cost and feedback time, but it usually has the biggest impact when developers can reuse cached results in their local builds. This is also the hardest to quantify for a number of reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>developers run different builds</p>
</li>
<li>
<p>developers can have different hardware, or have different settings</p>
</li>
<li>
<p>developers run all kinds of other things on their machines that can slow them down</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using Gradle Enterprise you can use the <a href="https://docs.gradle.com/enterprise/export-api/">Export API</a> to extract data about developer builds, too.
You can then create statistics on how many tasks were cached per developer or build.
You can even compare the times it took to execute the task vs loading it from the cache and then estimate the time saved per developer.</p>
</div>
<div class="paragraph">
<p>When using the <a href="https://gradle.com/build-cache">Gradle Enterprise build cache backend</a> you should pay close attention to the hit rate in the admin UI.
A rise in the hit rate there probably indicates better usage by developers:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/cache-admin-hit-rate.png" alt="build cache hit rate">
</div>
</div>
</div>
<div class="sect2">
<h3 id="analyzing_performance_in_build_scans"><a class="anchor" href="#analyzing_performance_in_build_scans"></a><a class="link" href="#analyzing_performance_in_build_scans">Analyzing performance in build scans</a></h3>
<div class="paragraph">
<p>Build scans provide a summary of all cache operations for a build via the <em>"Build cache"</em> section of the <em>"Performance"</em> page.</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/build-cache-performance.png" alt="build cache performance">
</div>
</div>
<div class="paragraph">
<p>This page details which tasks were able to be avoided by cache hits, and which missed.
It also indicates the hits and misses for the local and remote caches individually.
For remote cache operations, the time taken to transfer artifacts to and from the cache is given, along with the transfer rate.
This is particularly important for assessing the impact of network link quality on performance, as transfer times contribute to build time.</p>
</div>
</div>
<div class="sect2">
<h3 id="remote_cache_performance"><a class="anchor" href="#remote_cache_performance"></a><a class="link" href="#remote_cache_performance">Remote cache performance</a></h3>
<div class="paragraph">
<p>Improving the network link between the build and the remote cache can significantly improve build cache performance.
How to do this depends on the remote cache in use and your network environment.</p>
</div>
<div class="paragraph">
<p>The multi-node remote build cache provided by Gradle Enterprise is a fast and efficient, purpose built, remote build cache.
In particular, if your development team is geographically distributed, its replication features can significantly improve performance by allowing developers to use a cache that they have a good network link to.
See the <a href="https://docs.gradle.com/enterprise/admin/current/#replication">“Build Cache Replication” section of the Gradle Enterprise Admin Manual</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="important_concepts"><a class="anchor" href="#important_concepts"></a><a class="link" href="#important_concepts">Important concepts</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>How much of your build gets loaded from the cache depends on many factors.
In this section you will see some of the tools that are essential for well-cached builds.
<a href="https://gradle.com/build-scans">Build scans</a> are part of that toolchain and will be used throughout this guide.</p>
</div>
<div class="sect2">
<h3 id="build_cache_key"><a class="anchor" href="#build_cache_key"></a><a class="link" href="#build_cache_key">Build cache key</a></h3>
<div class="paragraph">
<p>Artifacts in the build cache are uniquely identified by a <em><a href="https://docs.gradle.org/5.4.1/userguide/build_cache.html#sec:task_output_caching_details">build cache key</a>.</em>
A build cache key is assigned to each cacheable task when running with the build cache enabled and is used for both loading and storing task outputs to the build cache.
The following inputs contribute to the build cache key for a task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The task implementation</p>
</li>
<li>
<p>The task action implementations</p>
</li>
<li>
<p>The names of the output properties</p>
</li>
<li>
<p>The names and values of task inputs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two tasks can reuse their outputs by using the build cache if their associated build cache keys are the same.</p>
</div>
</div>
<div class="sect2">
<h3 id="concepts_repeatable_task_outputs"><a class="anchor" href="#concepts_repeatable_task_outputs"></a><a class="link" href="#concepts_repeatable_task_outputs">Repeatable task outputs</a></h3>
<div class="paragraph">
<p>Assume that you have a code generator task as part of your build.
When you have a fully up to date build and you clean and re-run the code generator task on the same code base it should generate <em>exactly the same output</em>, so anything that depends on that output will stay up-to-date.</p>
</div>
<div class="paragraph">
<p>It might also be that your code generator adds some extra information to its output that doesn&#8217;t depend on its declared inputs, like a timestamp.
In such a case re-executing the task <em>will</em> result in different code being generated (because the timestamp will be updated).
Tasks that depend on the code generator&#8217;s output will need to be re-executed.</p>
</div>
<div class="paragraph">
<p>When a task is cacheable, then the very nature of task output caching makes sure that the task will have the same outputs for a given set of inputs.
Therefore, cacheable tasks should have repeatable task outputs.
If they don&#8217;t, then the result of executing the task and loading the task from the cache may be different, which can lead to hard-to-diagnose cache misses.</p>
</div>
<div class="paragraph">
<p>In some cases even well-trusted tools can produce non-repeatable outputs, and lead to cascading effects.
One example is Oracle&#8217;s Java compiler, which, <a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=8067422">due to a bug</a>, was producing different bytecode depending on the order source files to be compiled were presented to it.
If you were using Oracle JDK 8u31 or earlier to compile code in the <code>buildSrc</code> subproject, this could lead to all of your custom tasks producing occasional cache misses, because of the difference in their classpaths (which include <code>buildSrc</code>).</p>
</div>
<div class="paragraph">
<p>The key here is that cacheable tasks should not use non-repeatable task outputs as an input.</p>
</div>
</div>
<div class="sect2">
<h3 id="stable_task_inputs"><a class="anchor" href="#stable_task_inputs"></a><a class="link" href="#stable_task_inputs">Stable task inputs</a></h3>
<div class="paragraph">
<p>Having a task repeatably produce the same output is not enough if its inputs keep changing all the time.
Such unstable inputs can be supplied directly to the task. Consider a version number that includes a timestamp being added to the jar file&#8217;s manifest:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">version = "3.2-${System.currentTimeMillis()}"

jar {
    manifest {
        attributes("Implementation-Version": version)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">version = "3.2-${System.currentTimeMillis()}"

tasks.jar {
    manifest {
        attributes(mapOf("Implementation-Version" to version))
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the inputs for the <code>jar</code> task will be different for each build execution since this timestamp will continually change.</p>
</div>
<div class="paragraph">
<p>Another example for unstable inputs is the commit ID from version control.
Maybe your version number is generated via <code>git describe</code> (and you include it in the jar manifest as shown above).
Or maybe you include the commit hash directly in <code>version.properties</code> or a jar manifest attribute.
Either way, the outputs produced by any tasks depending on such data will only be re-usable by builds running against the exact same commit.</p>
</div>
<div class="paragraph">
<p>Another common, but less obvious source of unstable inputs is when a task consumes the output of another task which produces non-repeatable results, such as the example before of a code generator that embeds timestamps in its output.</p>
</div>
<div class="paragraph">
<p>A task can only be loaded from the cache if it has stable task inputs.
Unstable task inputs result in the task having a unique set of inputs for every build, which will always result in a cache miss.</p>
</div>
</div>
<div class="sect2">
<h3 id="normalization"><a class="anchor" href="#normalization"></a><a class="link" href="#normalization">Better reuse via input normalization</a></h3>
<div class="paragraph">
<p>Having stable inputs is crucial for cacheable tasks.
However, achieving byte for byte identical inputs for each task can be challenging.
In some cases sanitizing the output of a task to remove unnecessary information can be a good approach, but this also means that a task&#8217;s output can only be normalized for a single purpose.</p>
</div>
<div class="paragraph">
<p>This is where <a href="https://docs.gradle.org/5.4.1/userguide/more_about_tasks.html#sec:configure_input_normalization">input normalization</a> comes into play.
Input normalization is used by Gradle to determine if two task inputs are <em>essentially</em> the same.
Gradle uses normalized inputs when doing up-to-date checks and when determining if a cached result can be re-used instead of executing the task.
As input normalization is declared by the task <em>consuming</em> the data as input, different tasks can define different ways to normalize the same data.</p>
</div>
<div class="paragraph">
<p>When it comes to file inputs, Gradle can normalize the path of the files as well as their contents.</p>
</div>
<div class="sect3">
<h4 id="relocatability"><a class="anchor" href="#relocatability"></a><a class="link" href="#relocatability">Path sensitivity and relocatability</a></h4>
<div class="paragraph">
<p>When sharing cached results between computers, it&#8217;s rare that everyone runs the build from the exact same location on their computers.
To allow cached results to be shared even when builds are executed from different root directories, Gradle needs to understand which inputs can be relocated and which cannot.</p>
</div>
<div class="paragraph">
<p>Tasks having files as inputs can declare the parts of a file&#8217;s path what are essential to them: this is called the <a href="https://docs.gradle.org/5.4.1/javadoc/org/gradle/api/tasks/PathSensitive.html"><em>path sensitivity</em></a> of the input.
Task properties declared with <code>ABSOLUTE</code> path sensitivity are considered non-relocatable.
This is the default for properties not declaring path sensitivity, too.</p>
</div>
<div class="paragraph">
<p>For example, the class files produced by the Java compiler are dependent on the file names of the Java source files: renaming the source files with public classes would fail the build.
However, moving the files around has no effect on the result of the compilation.
Therefore, the path sensitivity for the sources of the <code>JavaCompile</code> task is <code>NAME_ONLY</code>. Because of this only the normalized paths of the Java source files&#8201;&#8212;&#8201;the file names&#8201;&#8212;&#8201;are considered as inputs to the <code>JavaCompile</code> task.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Java compiler only respects the package declaration in the Java source files, not the relative path of the sources.
As a consequence, path sensitivity for Java sources is <code>NAME_ONLY</code> and not <code>RELATIVE</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="content_normalization"><a class="anchor" href="#content_normalization"></a><a class="link" href="#content_normalization">Content normalization</a></h4>
<div class="sect4">
<h5 id="compile_avoidance"><a class="anchor" href="#compile_avoidance"></a><a class="link" href="#compile_avoidance">Compile avoidance for Java</a></h5>
<div class="paragraph">
<p>When it comes to the dependencies of a <code>JavaCompile</code> task (i.e. its <em>compile classpath),</em> only changes to the Application Binary Interface (ABI) of these dependencies require compilation to be executed.
Gradle has a deep understanding of what a compile classpath is and uses a sophisticated normalization strategy for it.
Task outputs can be re-used as long as the ABI of the classes on the compile classpath stays the same.
This enables Gradle to avoid Java compilation by using incremental builds, or load results from the cache that were produced by different (but ABI-compatible) versions of dependencies.
For more information on compile avoidance see the corresponding section in the <a href="https://docs.gradle.org/5.4.1/userguide/java_plugin.html#sec:java_compile_avoidance">user guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="runtime_classpath"><a class="anchor" href="#runtime_classpath"></a><a class="link" href="#runtime_classpath">Runtime classpath normalization</a></h5>
<div class="paragraph">
<p>Similar to compile avoidance, Gradle also understands the concept of a runtime classpath, and uses tailored input normalization to avoid running e.g. tests.
For runtime classpaths Gradle inspects the contents of jar files and ignores the timestamps and order of the entries in the jar file.
This means that a rebuilt jar file would be considered the same runtime classpath input.
For details on what level of understanding Gradle has for detecting changes to classpaths and what is considered as a classpath see the <a href="https://docs.gradle.org/5.4.1/userguide/more_about_tasks.html#sec:task_input_using_classpath_annotations">user guide</a>.</p>
</div>
<div class="sect5">
<h6 id="filter_runtime_classpath"><a class="anchor" href="#filter_runtime_classpath"></a><a class="link" href="#filter_runtime_classpath">Filtering runtime classpaths</a></h6>
<div class="paragraph">
<p>For a runtime classpath it is possible to provide better insights to Gradle which files are essential to the input by <a href="https://docs.gradle.org/5.4.1/userguide/more_about_tasks.html#sec:configure_input_normalization">configuring input normalization</a>.</p>
</div>
<div class="paragraph">
<p>Given that you want to add a file <code>build-info.properties</code> to all your produced jar files which contains volatile information about the build, e.g. the timestamp when the build started or some ID to identify the CI job that published the artifact.
This file is only used for auditing purposes, and has no effect on the outcome of running tests.
Nonetheless, this file is part of the runtime classpath for the <code>test</code> task. Since the file changes on every build invocation, tests cannot be cached effectively.
To fix this you can ignore <code>build-info.properties</code> on any runtime classpath by adding the following configuration to the build script in the <em>consuming</em> project:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">normalization {
    runtimeClasspath {
        ignore "build-info.properties"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">normalization {
    runtimeClasspath {
        ignore("build-info.properties")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If adding such a file to your jar files is something you do for all of the projects in your build, and you want to filter this file for all consumers, you may wrap the configurations described above in an <code>allprojects {}</code> or <code>subprojects {}</code> block in the root build script.</p>
</div>
<div class="paragraph">
<p>The effect of this configuration would be that changes to <code>build-info.properties</code> would be ignored for both up-to-date checks and task output caching.
All runtime classpath inputs for all tasks in the project where this configuration has been made will be affected.
This will not change the runtime behavior of the <code>test</code> task&#8201;&#8212;&#8201;i.e. any test is still able to load <code>build-info.properties</code>, and the runtime classpath stays the same as before.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="concepts_overlapping_outputs"><a class="anchor" href="#concepts_overlapping_outputs"></a><a class="link" href="#concepts_overlapping_outputs">The case against overlapping outputs</a></h3>
<div class="paragraph">
<p>When two tasks write to the same output directory or output file, it is difficult for Gradle to determine which output belongs to which task.
There are many edge cases, and executing the tasks in parallel cannot be done safely.
For the same reason, Gradle cannot remove <a href="https://docs.gradle.org/5.4.1/userguide/more_about_tasks.html#sec:stale_task_outputs">stale output files</a> for these tasks.
Tasks that have discrete, non-overlapping outputs can always be handled in a safe fashion by Gradle.
For the aforementioned reasons, task output caching is automatically disabled for tasks whose output directories overlap with another task.</p>
</div>
<div class="paragraph">
<p>Build scans show tasks where caching was disabled due to overlapping outputs in the timeline:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/overlapping-outputs-timeline.png" alt="overlapping outputs timeline">
</div>
</div>
</div>
<div class="sect2">
<h3 id="reuse_of_outputs_between_different_tasks"><a class="anchor" href="#reuse_of_outputs_between_different_tasks"></a><a class="link" href="#reuse_of_outputs_between_different_tasks">Reuse of outputs between different tasks</a></h3>
<div class="paragraph">
<p>Some builds exhibit a surprising characteristic: even when executed against an empty cache, they produce tasks loaded from cache. How is this possible? Rest assured that this is completely normal.</p>
</div>
<div class="paragraph">
<p>When considering task outputs, Gradle only cares about the inputs to the task: the task type itself, input files and parameters etc., but it doesn&#8217;t care about the task&#8217;s name or which project it can be found in.
Running <code>javac</code> will produce the same output regardless of the name of the <code>JavaCompile</code> task that invoked it.
If your build includes two tasks that share every input, the one executing later will be able to reuse the output produced by the first.</p>
</div>
<div class="paragraph">
<p>Having two tasks in the same build that do the same might sound like a problem to fix, but it is not necessarily something bad.
For example, the Android plugin creates several tasks for each variant of the project; some of those tasks will potentially do the same thing.
These tasks can safely reuse each other&#8217;s outputs.</p>
</div>
<div class="paragraph">
<p>As <a href="#share_results_between_ci_builds">discussed previously</a>, you can use Gradle Enterprise to diagnose the source build of these unexpected cache-hits.</p>
</div>
</div>
<div class="sect2">
<h3 id="non_cacheable_tasks"><a class="anchor" href="#non_cacheable_tasks"></a><a class="link" href="#non_cacheable_tasks">Non-cacheable tasks</a></h3>
<div class="paragraph">
<p>You&#8217;ve seen quite a bit about cacheable tasks, which implies there are non-cacheable ones, too. If caching task outputs is as awesome as it sounds, why not cache every task?</p>
</div>
<div class="paragraph">
<p>There are tasks that are definitely worth caching: tasks that do complex, repeatable processing and produce moderate amounts of output. Compilation tasks are usually ideal candidates for caching. At the other end of the spectrum lie I/O-heavy tasks, like <code>Copy</code> and <code>Sync</code>. Moving files around locally typically cannot be sped up by copying them from a cache. Caching those tasks would even waste good resources by storing all those redundant results in the cache.</p>
</div>
<div class="paragraph">
<p>Most tasks are either obviously worth caching, or obviously not. For those in-between a good rule of thumb is to see if downloading results would be significantly faster than producing them locally.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caching_java_projects"><a class="anchor" href="#caching_java_projects"></a><a class="link" href="#caching_java_projects">Caching Java projects</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As of Gradle 4.0, the build tool fully supports caching plain Java projects.
Built-in tasks for compiling, testing, documenting and checking the quality of Java code support the build cache out of the box.</p>
</div>
<div class="sect2">
<h3 id="java_compilation"><a class="anchor" href="#java_compilation"></a><a class="link" href="#java_compilation">Java compilation</a></h3>
<div class="paragraph">
<p>Caching Java compilation makes use of Gradle&#8217;s deep understanding of compile classpaths.
The mechanism <a href="#compile_avoidance">avoids recompilation</a> when dependencies change in a way that doesn&#8217;t affect their application binary interfaces (ABI).
Since the cache key is only influenced by the ABI of dependencies (and not by their implementation details like private types and method bodies), task output caching can also reuse compiled classes if they were produced by the same sources and ABI-equivalent dependencies.</p>
</div>
<div class="paragraph">
<p>For example, take a project with two modules: an application depending on a library.
Suppose the latest version is already built by CI and uploaded to the shared cache.
If a developer now modifies a method&#8217;s body in the library, the library will need to be rebuilt on their computer. But they will be able to load the compiled classes for the application from the shared cache. Gradle can do this because the library used to compile the application on CI, and the modified library available locally share the same ABI.</p>
</div>
<div class="sect3">
<h4 id="annotation_processors"><a class="anchor" href="#annotation_processors"></a><a class="link" href="#annotation_processors">Annotation processors</a></h4>
<div class="paragraph">
<p>Compile avoidance works out of the box.
There is one caveat though: when using annotation processors, Gradle uses the annotation processor classpath as an input.
Unlike most compile dependencies, in which only the ABI influences compilation, the <em>implementation</em> of annotation processors must be considered as an input to the compiler. For this reason Gradle will treat annotation processors as a <em>runtime</em> classpath, meaning less <a href="#runtime_classpath">input normalization</a> is taking place there.
If Gradle detects an annotation processor on the compile classpath, the annotation processor classpath defaults to the compile classpath when not explicitly set, which in turn means the entire compile classpath is treated as a runtime classpath input.</p>
</div>
<div class="paragraph">
<p>For the example above this would mean the ABI extracted from the compile classpath would be unchanged, but the annotation processor classpath (because it&#8217;s not treated with compile avoidance) would be different. Ultimately, the developer would end up having to recompile the application.</p>
</div>
<div class="paragraph">
<p>The easiest way to avoid this performance penalty is to not use annotation processors. However, if you need to use them, make sure you set the annotation processor classpath explicitly to include only the libraries needed for annotation processing. The <a href="https://docs.gradle.org/5.4.1/userguide/java_plugin.html#sec:java_compile_avoidance">user guide</a> describes how to do this.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some common Java dependencies (such as Log4j 2.x) come bundled with annotation processors. If you use these dependencies, but do not leverage the features of the bundled annotation processors, it&#8217;s best to disable annotation processing entirely. This can be done by setting the annotation processor classpath to an empty set.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unit_test_execution"><a class="anchor" href="#unit_test_execution"></a><a class="link" href="#unit_test_execution">Unit test execution</a></h3>
<div class="paragraph">
<p>The <code>Test</code> task used for test execution for JVM languages employs <a href="#runtime_classpath">runtime classpath normalization</a> for its classpath.
This means that changes to order and timestamps in jars on the test classpath will not cause the task to be out-of-date or change the build cache key.
For achieving <a href="#stable_task_inputs">"Stable task inputs"</a> you also can wield the power of <a href="#filter_runtime_classpath">filtering the runtime classpath</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="integration_test_execution"><a class="anchor" href="#integration_test_execution"></a><a class="link" href="#integration_test_execution">Integration test execution</a></h3>
<div class="paragraph">
<p>Unit tests are easy to cache as they normally have no external dependencies.
For integration tests the situation can be quite different, as they can depend on a variety of inputs outside of the test and production code.
These external factors can be for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>operating system type and version,</p>
</li>
<li>
<p>external tools being installed for the tests,</p>
</li>
<li>
<p>environment variables and Java system properties,</p>
</li>
<li>
<p>other services being up and running,</p>
</li>
<li>
<p>a distribution of the software under test.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You need to be careful to declare these additional inputs for your integration test in order to avoid incorrect cache hits.
For example, declaring the operating system in use by Gradle as an input to a <code>Test</code> task called <code>integTest</code> would work as follows:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">integTest {
    inputs.property("operatingSystem") {
        System.getProperty("os.name")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.getByName&lt;Test&gt;("integTest") {
    inputs.property("operatingSystem") {
        System.getProperty("os.name")
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="archives_as_inputs"><a class="anchor" href="#archives_as_inputs"></a><a class="link" href="#archives_as_inputs">Archives as inputs</a></h4>
<div class="paragraph">
<p>It is common for the integration tests to depend on your packaged application.
If this happens to be a zip or tar archive, then adding it as an input to the integration test task may lead to cache misses.
This is because, as described in <a href="#concepts_repeatable_task_outputs">"Repeatable task outputs"</a>, rebuilding an archive often changes the metadata in the archive.
You can depend on the exploded contents of the archive instead.
See also the section on dealing with <a href="#volatile_outputs">non-repeatable outputs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="dealing_with_file_paths"><a class="anchor" href="#dealing_with_file_paths"></a><a class="link" href="#dealing_with_file_paths">Dealing with file paths</a></h4>
<div class="paragraph">
<p>You will probably pass some information from the build environment to your integration test tasks by using system properties.
Passing absolute paths will break <a href="#relocatability">relocatability</a> of the integration test task.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">// Don't do this! Breaks relocatability!
integTest {
    systemProperty "distribution.location", file("build/dist").absolutePath
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.getByName&lt;Test&gt;("integTest") {
    // Don't do this! Breaks relocatability!
    systemProperty("distribution.location", file("build/dist").absolutePath)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of adding the absolute path directly as a system property, it is possible to add an
annotated <code><a href="https://docs.gradle.org/5.4.1/javadoc/org/gradle/process/CommandLineArgumentProvider.html">CommandLineArgumentProvider</a></code> to the <code>integTest</code> task:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class DistributionLocationProvider implements CommandLineArgumentProvider { <i class="conum" data-value="1"></i><b>(1)</b>
    @InputDirectory
    @PathSensitive(PathSensitivity.RELATIVE)                                <i class="conum" data-value="2"></i><b>(2)</b>
    File distribution

    @Override
    Iterable&lt;String&gt; asArguments() {
        ["-Ddistribution.location=${distribution.absolutePath}".toString()] <i class="conum" data-value="3"></i><b>(3)</b>
    }
}

integTest {
    jvmArgumentProviders.add(
        new DistributionLocationProvider(distribution: file("build/dist"))  <i class="conum" data-value="4"></i><b>(4)</b>
    )
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">class DistributionLocationProvider(                                     <i class="conum" data-value="1"></i><b>(1)</b>
    @InputDirectory
    @PathSensitive(PathSensitivity.RELATIVE)                            <i class="conum" data-value="2"></i><b>(2)</b>
    var distribution: File
) : CommandLineArgumentProvider {

    override fun asArguments(): Iterable&lt;String&gt; =
        listOf("-Ddistribution.location=${distribution.absolutePath}")  <i class="conum" data-value="3"></i><b>(3)</b>
}

tasks.getByName&lt;Test&gt;("integTest") {
    jvmArgumentProviders.add(
        DistributionLocationProvider(file("build/dist")) <i class="conum" data-value="4"></i><b>(4)</b>
    )
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a class implementing <code><a href="https://docs.gradle.org/5.4.1/javadoc/org/gradle/process/CommandLineArgumentProvider.html">CommandLineArgumentProvider</a></code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare the inputs and outputs with the corresponding path sensitivity.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>asArguments</code> needs to return the JVM arguments passing the desired system properties to the test JVM.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Add an instance of the newly created class as JVM argument provider to the integration test task.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ignoring_system_properties"><a class="anchor" href="#ignoring_system_properties"></a><a class="link" href="#ignoring_system_properties">Ignoring system properties</a></h4>
<div class="paragraph">
<p>It may be necessary to ignore some system properties as inputs as they do not influence the outcome of the integration tests.
In order to do so, add a <code><a href="https://docs.gradle.org/5.4.1/javadoc/org/gradle/process/CommandLineArgumentProvider.html">CommandLineArgumentProvider</a></code> to the <code>integTest</code> task:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">class CiEnvironmentProvider implements CommandLineArgumentProvider {
    @Internal                                                        <i class="conum" data-value="1"></i><b>(1)</b>
    String agentNumber = System.getenv().get("AGENT_NUMBER") ?: "1"

    @Override
    Iterable&lt;String&gt; asArguments() {
        ["-DagentNumber=${agentNumber}".toString()]                  <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

integTest {
    jvmArgumentProviders.add(
        new CiEnvironmentProvider()                                  <i class="conum" data-value="3"></i><b>(3)</b>
    )
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">class CiEnvironmentProvider : CommandLineArgumentProvider {
    @Internal                                                <i class="conum" data-value="1"></i><b>(1)</b>
    val agentNumber = System.getenv()["AGENT_NUMBER"] ?: "1"

    override fun asArguments(): Iterable&lt;String&gt; =
        listOf("-DagentNumber=$agentNumber")                 <i class="conum" data-value="2"></i><b>(2)</b>
}

tasks.getByName&lt;Test&gt;("integTest") {
    jvmArgumentProviders.add(
        CiEnvironmentProvider()                              <i class="conum" data-value="3"></i><b>(3)</b>
    )
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Internal</code> means that this property does not influence the output of the integration tests.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The system properties for the actual test execution.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Add an instance of the newly created class as JVM argument provider to the integration test task.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching_code_buildsrc_code"><a class="anchor" href="#caching_code_buildsrc_code"></a><a class="link" href="#caching_code_buildsrc_code">Caching <code>buildSrc</code></a></h3>
<div class="paragraph">
<p>The <a href="https://docs.gradle.org/5.4.1/userguide/organizing_gradle_projects.html#sec:build_sources"><code>buildSrc</code> project</a> can be used to organize build logic in your Gradle build.
While <code>buildSrc</code> typically does not change frequently, when it does every developer and CI agent needs to re-build and test it.
Therefore, it is usually desirable to use task output caching for <code>buildSrc</code>, too.
To use the same build cache configuration for <code>buildSrc</code> as for your root project, you can apply the same script both in <code>buildSrc/settings.gradle</code> and in <code>settings.gradle</code> as shown in the <a href="https://docs.gradle.org/5.4.1/userguide/build_cache.html#buildCacheBuildSrc">user guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caching_android_projects"><a class="anchor" href="#caching_android_projects"></a><a class="link" href="#caching_android_projects">Caching Android projects</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>While it is true that Android uses the Java toolchain as its foundation, there are nevertheless some significant differences from pure Java projects; these differences impact task cacheability.
This is even more true for Android projects that include Kotlin source code (and therefore use the <code>kotlin-android</code> plugin).</p>
</div>
<div class="sect2">
<h3 id="disambiguation"><a class="anchor" href="#disambiguation"></a><a class="link" href="#disambiguation">Disambiguation</a></h3>
<div class="paragraph">
<p>This guide is about Gradle’s build cache, but you may have also heard about the <a href="https://developer.android.com/studio/build/build-cache">Android build cache</a>.
These are different things.
The Android cache is internal to certain tasks in the Android plugin, and will eventually be removed in favor of native Gradle support.</p>
</div>
</div>
<div class="sect2">
<h3 id="why_use_the_build_cache"><a class="anchor" href="#why_use_the_build_cache"></a><a class="link" href="#why_use_the_build_cache">Why use the build cache?</a></h3>
<div class="paragraph">
<p>The build cache can <em>significantly</em> improve build performance for Android projects, in many cases by 30-40%.
Many of the compilation and assembly tasks provided by the Android Gradle Plugin are cacheable, and more are made so with each new iteration.</p>
</div>
<div class="sect3">
<h4 id="faster_ci_builds"><a class="anchor" href="#faster_ci_builds"></a><a class="link" href="#faster_ci_builds">Faster CI builds</a></h4>
<div class="paragraph">
<p>CI builds benefit particularly from the build cache.
A typical CI build starts with a <code>clean</code>, which means that pre-existing build outputs are deleted and none of the tasks that make up the build will be <code>UP-TO-DATE</code>.
However, it is likely that many of those tasks will have been run with exactly the same inputs in a prior CI build, populating the build cache; the outputs from those prior runs can safely be reused, resulting in dramatic build performance improvements.</p>
</div>
</div>
<div class="sect3">
<h4 id="reusing_ci_builds_for_local_development"><a class="anchor" href="#reusing_ci_builds_for_local_development"></a><a class="link" href="#reusing_ci_builds_for_local_development">Reusing CI builds for local development</a></h4>
<div class="paragraph">
<p>When you sign into work at the start of your day, it’s not unusual for your first task to be pulling master and then running a build (Android Studio will probably do the latter, whether you ask it to or not).
Assuming all merges to master are built on CI (a best practice!), you can expect this first local build of the day to enjoy a larger-than-typical benefit with Gradle’s <em>remote cache</em>.
CI already built this commit&#8201;&#8212;&#8201;why should you re-do that work?</p>
</div>
</div>
<div class="sect3">
<h4 id="switching_branches"><a class="anchor" href="#switching_branches"></a><a class="link" href="#switching_branches">Switching branches</a></h4>
<div class="paragraph">
<p>During local development, it is not uncommon to switch branches several times per day.
This defeats <a href="https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:up_to_date_checks">incremental build</a> (i.e., <code>UP-TO-DATE</code> checks), but this issue is mitigated via use of the local build cache.
You might run a build on Branch A, which will populate the local cache.
You then switch to Branch B to conduct a code review, help a colleague, or address feedback on an open PR.
You then switch back to Branch A to continue your original work.
When you next build, all of the outputs previously built while working on Branch A can be reused from the cache, saving potentially a lot of time.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the_android_gradle_plugin_and_the_gradle_build_tool"><a class="anchor" href="#the_android_gradle_plugin_and_the_gradle_build_tool"></a><a class="link" href="#the_android_gradle_plugin_and_the_gradle_build_tool">The Android Gradle Plugin and the Gradle Build Tool</a></h3>
<div class="paragraph">
<p>The first thing you should always do when working to optimize your build is ensure you’re on the latest stable, supported versions of the Android Gradle Plugin and the Gradle Build Tool.
At the time of writing, they are 3.3.0 and 5.0, respectively.
Each new version of these tools includes many performance improvements, not least of which is to the build cache.</p>
</div>
</div>
<div class="sect2">
<h3 id="java_and_kotlin_compilation"><a class="anchor" href="#java_and_kotlin_compilation"></a><a class="link" href="#java_and_kotlin_compilation">Java and Kotlin compilation</a></h3>
<div class="paragraph">
<p>The <a href="https://guides.gradle.org/using-build-cache/#java_compilation">discussion</a> above in “Caching Java projects” is equally relevant here, with the caveat that, for projects that include Kotlin source code, the Kotlin compiler does not currently support <a href="https://docs.gradle.org/current/userguide/java_plugin.html#sec:java_compile_avoidance">compile avoidance</a> in the way that the Java compiler does.</p>
</div>
</div>
<div class="sect2">
<h3 id="annotation_processors_and_kotlin"><a class="anchor" href="#annotation_processors_and_kotlin"></a><a class="link" href="#annotation_processors_and_kotlin">Annotation processors and Kotlin</a></h3>
<div class="paragraph">
<p>The <a href="https://guides.gradle.org/using-build-cache/#annotation_processors">advice above</a> for pure Java projects also applies to Android projects.
However, if you are using annotation processors (such as Dagger2 or Butterknife) in conjunction with Kotlin and the kotlin-kapt plugin, you should know that kapt is not cached by default.
<a href="https://blog.jetbrains.com/kotlin/2018/01/kotlin-1-2-20-is-out/">You can opt into it</a> (which is recommended) by adding the following to your root build.gradle script:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">subprojects {
    pluginManager.withPlugin("kotlin-kapt") {
        kapt.useBuildCache = true
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">subprojects {
    pluginManager.withPlugin("kotlin-kapt") {
        configure&lt;KaptExtension&gt; {
            useBuildCache = true
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is an <a href="https://youtrack.jetbrains.com/issue/KT-27675">open issue</a> on the JetBrains issue tracker to enable the build cache for kapt by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="unit_test_execution_2"><a class="anchor" href="#unit_test_execution_2"></a><a class="link" href="#unit_test_execution_2">Unit test execution</a></h3>
<div class="paragraph">
<p>Unlike with unit tests in a pure Java project, the equivalent test task in an Android project (<code>AndroidUnitTest</code>) is not cacheable.
The Google Team is working to make these tests cacheable.
Please see <a href="https://issuetracker.google.com/issues/79122161">this issue</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="instrumented_test_execution_i_e_espresso_tests"><a class="anchor" href="#instrumented_test_execution_i_e_espresso_tests"></a><a class="link" href="#instrumented_test_execution_i_e_espresso_tests">Instrumented test execution (i.e., Espresso tests)</a></h3>
<div class="paragraph">
<p>Android instrumented tests (<code>DeviceProviderInstrumentTestTask</code>), often referred to as “Espresso” tests, are also not cacheable.
The Google Android team is also working to make such tests cacheable.
Please see <a href="https://issuetracker.google.com/issues/115873051">this issue</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="lint"><a class="anchor" href="#lint"></a><a class="link" href="#lint">Lint</a></h3>
<div class="paragraph">
<p>Users of Android’s <code>Lint</code> task are well aware of the heavy performance penalty they pay for using it, but also know that it is indispensable for finding common issues in Android projects.
Currently, this task is not cacheable.
This task is planned to be cacheable with the release of Android Gradle Plugin 3.5.
This is another reason to always use the latest version of the Android plugin!</p>
</div>
</div>
<div class="sect2">
<h3 id="the_fabric_plugin_and_crashlytics"><a class="anchor" href="#the_fabric_plugin_and_crashlytics"></a><a class="link" href="#the_fabric_plugin_and_crashlytics">The Fabric Plugin and Crashlytics</a></h3>
<div class="paragraph">
<p>The <a href="https://docs.fabric.io/android/fabric/overview.html">Fabric</a> plugin, which is used to integrate the Crashlytics crash-reporting tool (among others), is very popular, yet imposes some hefty performance penalties during the build process.
This is due to the need for each version of your app to have a unique identifier so that it can be identified in the Crashlytics dashboard.
In practice, the default behavior of Crashlytics is to treat “each version” as synonymous with “each build”.
This defeats <a href="https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:up_to_date_checks">incremental build</a>, because each build will be unique.
It also breaks the cacheability of certain tasks in the build, and for the same reason.
This can be fixed by simply disabling Crashlytics in “debug” builds.
You may find instructions for that in the <a href="https://docs.fabric.io/android/crashlytics/build-tools.html">Crashlytics documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The fix described in the referenced documentation does not work directly if you are using the Kotlin DSL; see below for the workaround.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="kotlin_dsl"><a class="anchor" href="#kotlin_dsl"></a><a class="link" href="#kotlin_dsl">Kotlin DSL</a></h4>
<div class="paragraph">
<p>The fix described in the referenced documentation does not work directly if you are using the Kotlin DSL; this is due to incompatibilities between that Kotlin DSL and the Fabric plugin.
There is a simple workaround for this, based on <a href="https://docs.gradle.org/5.0/userguide/kotlin_dsl.html#using_a_groovy_script">this advice</a> from the Kotlin DSL primer.</p>
</div>
<div class="paragraph">
<p>Create a file, <code>fabric.gradle</code>, in the module where you apply the <code>io.fabric</code> plugin. This file (known as a script plugin), should have the following contents:</p>
</div>
<div class="listingblock">
<div class="title">fabric.gradle</div>
<div class="content">
<pre>// or "com.android.library"
project.pluginManager.withPlugin("com.android.application") {
    android.buildTypes.debug.ext.enableCrashlytics = false
}</pre>
</div>
</div>
<div class="paragraph">
<p>And then, in the module’s <code>build.gradle.kts</code> file, apply this script plugin:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre>apply(from = "fabric.gradle")</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debugging_and_diagnosing_cache_misses"><a class="anchor" href="#debugging_and_diagnosing_cache_misses"></a><a class="link" href="#debugging_and_diagnosing_cache_misses">Debugging and diagnosing cache misses</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>To make the most of task output caching, it is important that any necessary inputs to your tasks are specified correctly, while at the same time avoiding unneeded inputs.
Failing to specify an input that affects the task&#8217;s outputs can result in incorrect builds, while needlessly specifying inputs that do not affect the task&#8217;s output can cause cache misses.</p>
</div>
<div class="paragraph">
<p>This chapter is about finding out why a cache miss happened.
If you have a cache hit which you didn&#8217;t expect we suggest to declare whatever change you expected to trigger the cache miss as an input to the task.</p>
</div>
<div class="sect2">
<h3 id="finding_problems"><a class="anchor" href="#finding_problems"></a><a class="link" href="#finding_problems">Finding problems with task output caching</a></h3>
<div class="paragraph">
<p>Below we describe a step-by-step process that should help shake out any problems with caching in your build.</p>
</div>
<div class="sect3">
<h4 id="ensure_incremental_build_works"><a class="anchor" href="#ensure_incremental_build_works"></a><a class="link" href="#ensure_incremental_build_works">Ensure incremental build works</a></h4>
<div class="paragraph">
<p>First, make sure your build does the right thing without the cache.
Run a build twice without enabling the Gradle build cache.
The expected outcome is that all actionable tasks that produce file outputs are up-to-date.
You should see something like this on the command-line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew clean --quiet <i class="conum" data-value="1"></i><b>(1)</b>
$ ./gradlew assemble <i class="conum" data-value="2"></i><b>(2)</b>

BUILD SUCCESSFUL in 1s
4 actionable tasks: 4 executed

$ ./gradlew assemble <i class="conum" data-value="3"></i><b>(3)</b>

BUILD SUCCESSFUL in 1s
4 actionable tasks: 4 up-to-date</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make sure we start without any leftover results by running <code>clean</code> first.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We are assuming your build is represented by running the <code>assemble</code> task in these examples, but you can substitute whatever tasks make sense for your build.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Run the build again without running <code>clean</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tasks that have no outputs or no inputs will always be executed, but that shouldn&#8217;t be a problem.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the methods as described below to <a href="#diagnosing_cache_miss">diagnose</a> and <a href="#common-problems">fix</a> tasks that should be up-to-date but aren&#8217;t.
If you find a task which is out of date, but no cacheable tasks depends on its outcome, then you don&#8217;t have to do anything about it.
The goal is to achieve <a href="#stable_task_inputs">"Stable task inputs"</a> for cacheable tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="in-place_caching_test"><a class="anchor" href="#in-place_caching_test"></a><a class="link" href="#in-place_caching_test">In-place caching with the local cache</a></h4>
<div class="paragraph">
<p>When you are happy with the up-to-date performance then you can repeat the experiment above, but this time with a clean build, and the build cache turned on.
The goal with clean builds and the build cache turned on is to retrieve all cacheable tasks from the cache.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When running this test make sure that you have no <code>remote</code> cache configured, and storing in the <code>local</code> cache is enabled.
These are the default settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This would look something like this on the command-line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ rm -rf ~/.gradle/caches/build-cache-1 <i class="conum" data-value="1"></i><b>(1)</b>
$ ./gradlew clean --quiet <i class="conum" data-value="2"></i><b>(2)</b>
$ ./gradlew assemble --build-cache <i class="conum" data-value="3"></i><b>(3)</b>

BUILD SUCCESSFUL in 1s
4 actionable tasks: 4 executed

$ ./gradlew clean --quiet <i class="conum" data-value="4"></i><b>(4)</b>
$ ./gradlew assemble --build-cache <i class="conum" data-value="5"></i><b>(5)</b>

BUILD SUCCESSFUL in 1s
4 actionable tasks: 1 executed, 3 from cache</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We want to start with an empty local cache.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Clean the project to remove any unwanted leftovers from previous builds.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Build it once to let it populate the cache.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Clean the project again.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Build it again: this time everything cacheable should load from the just populated cache.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should see all cacheable tasks loaded from cache, while non-cacheable tasks should be executed.</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/fully-cached-task-execution.png" alt="fully cached task execution">
</div>
</div>
<div class="paragraph">
<p>Again, use the below methods to <a href="#diagnosing_cache_miss">diagnose</a> and <a href="#common-problems">fix</a> cacheability issues.</p>
</div>
</div>
<div class="sect3">
<h4 id="caching_relocation_test"><a class="anchor" href="#caching_relocation_test"></a><a class="link" href="#caching_relocation_test">Testing cache relocatability</a></h4>
<div class="paragraph">
<p>Once everything loads properly while building the same checkout with the local cache enabled, it&#8217;s time to see if there are any <em>relocation problems.</em>
A task is considered <em>relocatable</em> if its output can be reused when the task is executed in a different location. (More on this in <a href="#relocatability">"Path sensitivity and relocatability"</a>.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tasks that should be relocatable but aren&#8217;t are usually a result of absolute paths being present among the task&#8217;s inputs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To discover these problems, first check out the same commit of your project in two different directories on your machine.
For the following example let&#8217;s assume we have a checkout in <code>\~/checkout-1</code> and <code>\~/checkout-2</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Like with the previous test, you should have no <code>remote</code> cache configured, and storing in the <code>local</code> cache should be enabled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>$ rm -rf ~/.gradle/caches/build-cache-1 <i class="conum" data-value="1"></i><b>(1)</b>
$ cd ~/checkout-1 <i class="conum" data-value="2"></i><b>(2)</b>
$ ./gradlew clean --quiet <i class="conum" data-value="3"></i><b>(3)</b>
$ ./gradlew assemble --build-cache <i class="conum" data-value="4"></i><b>(4)</b>

BUILD SUCCESSFUL in 1s
4 actionable tasks: 4 executed

$ cd ~/checkout-2 <i class="conum" data-value="5"></i><b>(5)</b>
$ ./gradlew clean --quiet <i class="conum" data-value="6"></i><b>(6)</b>
$ ./gradlew clean assemble --build-cache <i class="conum" data-value="7"></i><b>(7)</b>

BUILD SUCCESSFUL in 1s
4 actionable tasks: 1 executed, 3 from cache</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remove all entries in the local cache first.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Go to the first checkout directory.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Clean the project to remove any unwanted leftovers from previous builds.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Run a build to populate the cache.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Go to the other checkout directory.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Clean the project again.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Run a build again.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should see the exact same results as you saw with the previous <a href="#in-place_caching_test">in place caching test</a> step.</p>
</div>
</div>
<div class="sect3">
<h4 id="cross_platform_tests"><a class="anchor" href="#cross_platform_tests"></a><a class="link" href="#cross_platform_tests">Cross-platform tests</a></h4>
<div class="paragraph">
<p>If your build passes the <a href="#caching_relocation_test">relocation test</a>, it is in good shape already.
If your build requires support for multiple platforms, it is best to see if the required tasks get reused between platforms, too.
A typical example of cross-platform builds is when CI runs on Linux VMs, while developers use macOS or Windows, or a different variety or version of Linux.</p>
</div>
<div class="paragraph">
<p>To test cross-platform cache reuse, set up a <code>remote</code> cache (see <a href="#share_results_between_ci_builds">Share results between CI builds</a>) and populate it from one platform and consume it from the other.</p>
</div>
</div>
<div class="sect3">
<h4 id="incremental_cache_usage"><a class="anchor" href="#incremental_cache_usage"></a><a class="link" href="#incremental_cache_usage">Incremental cache usage</a></h4>
<div class="paragraph">
<p>After these experiments with fully cached builds, you can go on and try to make typical changes to your project and see if enough tasks are still cached.
If the results are not satisfactory, you can think about restructuring your project to reduce dependencies between different tasks.</p>
</div>
</div>
<div class="sect3">
<h4 id="evaluating_cache_performance_over_time"><a class="anchor" href="#evaluating_cache_performance_over_time"></a><a class="link" href="#evaluating_cache_performance_over_time">Evaluating cache performance over time</a></h4>
<div class="paragraph">
<p>Consider recording execution times of your builds, generating graphs, and analyzing the results.
Keep an eye out for certain patterns, like a build recompiling everything even though you expected compilation to be cached.</p>
</div>
<div class="paragraph">
<p>You can also make changes to your code base manually or automatically and check that the expected set of tasks is cached.</p>
</div>
<div class="paragraph">
<p>If you have tasks that are re-executing instead of loading their outputs from the cache, then it may point to a problem in your build.
Techniques for debugging a cache miss are explained in the following section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="helpful_data_for_diagnosing_a_cache_miss"><a class="anchor" href="#helpful_data_for_diagnosing_a_cache_miss"></a><a class="link" href="#helpful_data_for_diagnosing_a_cache_miss">Helpful data for diagnosing a cache miss</a></h3>
<div class="paragraph">
<p>A cache miss happens when Gradle calculates a build cache key for a task which is different from any existing build cache key in the cache.
Only comparing the build cache key on its own does not give much information, so we need to look at some finer grained data to be able to diagnose the cache miss.
A list of all inputs to the computed build cache key can be found in the <a href="https://docs.gradle.org/5.4.1/userguide/build_cache.html#sec:task_output_caching_details">user guide</a>.</p>
</div>
<div class="paragraph">
<p>From most coarse grained to most fine grained, the items we will use to compare two tasks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build cache keys</p>
</li>
<li>
<p>Task and Task action implementations</p>
<div class="ulist">
<ul>
<li>
<p>classloader hash</p>
</li>
<li>
<p>class name</p>
</li>
</ul>
</div>
</li>
<li>
<p>Task output property names</p>
</li>
<li>
<p>Individual task property input hashes</p>
</li>
<li>
<p>Hashes of files which are part of task input properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want information about the build cache key and individual input property hashes, use <a href="https://docs.gradle.org/5.4.1/userguide/build_environment.html#sec:gradle_configuration_properties"><code>-Dorg.gradle.caching.debug=true</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew :compileJava --build-cache -Dorg.gradle.caching.debug=true

.
.
.
Appending taskClass to build cache key: org.gradle.api.tasks.compile.JavaCompile_Decorated
Appending classLoaderHash to build cache key: da6eca52100422099189290bf68f200a
Appending actionType to build cache key: org.gradle.api.internal.project.taskfactory.AbstractOutputPropertyAnnotationHandler$2$1
Appending actionClassLoaderHash to build cache key: 2cdf3f9202925b5befa161030ab43724
Appending actionType to build cache key: org.gradle.api.internal.project.taskfactory.TaskClassValidator
.
.
.
Appending inputPropertyHash for 'classpath' to build cache key: 2b6ab53aa11d4a7d4a1f95a8f78f4d7c
Appending inputPropertyHash for 'effectiveAnnotationProcessorPath' to build cache key: d41d8cd98f00b204e9800998ecf8427e
Appending inputPropertyHash for 'options.sourcepath' to build cache key: d41d8cd98f00b204e9800998ecf8427e
Appending inputPropertyHash for 'source' to build cache key: f6ba49b2466f0090272c43ac5f54ec1d
Appending outputPropertyName to build cache key: destinationDir
Build cache key for task ':compileJava' is 2b220117efa6710f7ab191a0bbe48c00</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to go into the details of finding out e.g. which classes and jar files constitute the <code>classpath</code> for the <code>compileJava</code>
task you need to resort to comparing those files on disk yourself.</p>
</div>
<div class="paragraph">
<p>Luckily, you do not have to capture this data yourself - the build scan plugin already takes care of this for you.
Gradle Enterprise has the necessary data to diagnose the cache miss when comparing two build scans, and will show you the properties that caused a different cache key to be generated.</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/adjacent-builds-input-comparison.png" alt="adjacent builds input comparison">
</div>
</div>
<div class="paragraph">
<p>There are three ways to compare builds in Gradle Enterprise.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the scan list to find the scans to compare, selecting them by clicking the respective <span class="image inline-icon"><img src="images/compare-small.svg" alt="compare" width="30"></span> or <span class="image inline-icon"><img src="images/compare-small-b.svg" alt="compare b" width="30"></span> icon.</p>
</li>
<li>
<p>From a scan that you wish to compare with another, click the <span class="image inline-icon"><img src="images/compare-small.svg" alt="compare" width="30"></span> icon at the top of the scan, then select the second scan by clicking the  <span class="image inline-icon"><img src="images/compare-small-b.svg" alt="compare b" width="30"></span> icon from the list of scans.</p>
</li>
<li>
<p>Click the <span class="image inline-icon"><img src="images/previous-next-scan.svg" alt="workspace" width="22"></span> icon in the header of a build scan to show previous and subsequent build scans of the same workspace, then click the <span class="image inline-icon"><img src="images/compare-small-b.svg" alt="compare b" width="30"></span> icon next to the build you want to compare.</p>
</li>
</ol>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/adjacent-build-comparison.png" alt="adjacent build comparison">
</div>
</div>
<div class="paragraph">
<p>It is also possible that task output caching for a cacheable task was disabled.
When this happens the reason why caching was disabled for the task is reported on the info log level and in the build scan:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/caching-disabled.png" alt="caching disabled">
</div>
</div>
</div>
<div class="sect2">
<h3 id="diagnosing_cache_miss"><a class="anchor" href="#diagnosing_cache_miss"></a><a class="link" href="#diagnosing_cache_miss">Diagnosing the reasons for a cache miss</a></h3>
<div class="paragraph">
<p>Having the data from the last section at hand, you should be able to diagnose why the outputs of a certain task were not found in the build cache.
Since you were expecting more tasks to be cached, you should be able to pinpoint a build which would have produced the artifact under question.</p>
</div>
<div class="paragraph">
<p>Before diving into how to find out why one task has not been loaded from the cache we should first look into which task caused the cache misses.
There is a cascade effect which causes dependent tasks to be executed if one of the tasks earlier in the build is not loaded from the cache and has different outputs.
Therefore, you should locate the first cacheable task which was executed and continue investigating from there.
This can be done from the timeline view in a build scan or from the task input comparison directly:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/first-non-cached-task.png" alt="first non cached task">
</div>
</div>
<div class="paragraph">
<p>At first, you should check if the implementation of the task changed. This would mean checking the class names and classloader hashes
for the task class itself and for each of its actions. If there is a change, this means that the build script, <code>buildSrc</code> or the Gradle version has changed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A change in the output of <code>buildSrc</code> also marks all the logic added by your build as changed.
Especially, custom actions added to cacheable tasks will be marked as changed.
This can be problematic, see <a href="#custom_actions">"Review usages of `doFirst` and `doLast`"</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the implementation is the same, then you need to start comparing inputs between the two builds.
There should be at least one different input hash. If it is a simple value property, then the configuration of the task changed.
This can happen for example by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>changing the build script,</p>
</li>
<li>
<p>conditionally configuring the task differently for CI or the developer builds,</p>
</li>
<li>
<p>depending on a system property or an environment variable for the task configuration,</p>
</li>
<li>
<p>or having an absolute path which is part of the input.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the changed property is a file property, then the reasons can be the same as for the change of a value property.
Most probably though a file on the filesystem changed in a way that Gradle detects a difference for this input.
The most common case will be that the source code was changed by a check in.
It is also possible that a file generated by a task changed, e.g. since it includes a timestamp.
As described in <a href="#java_version_tracking">"Java version tracking"</a>, the Java version can also influence the output of the Java compiler.
If you did not expect the file to be an input to the task, then it is possible that you should alter the configuration of the task to not include it.
For example, having your integration test configuration including all the unit test classes as a dependency has the effect that all integration tests
are re-executed when a unit test changes.
Another option is that the task tracks absolute paths instead of relative paths and the location of the project directory changed on disk.</p>
</div>
</div>
<div class="sect2">
<h3 id="example"><a class="anchor" href="#example"></a><a class="link" href="#example">Example</a></h3>
<div class="paragraph">
<p>We will walk you through the process of diagnosing a cache miss.
Let&#8217;s say we have build <code>A</code> and build <code>B</code> and we expected all the test tasks for a sub-project <code>sub1</code> to be cached in build <code>B</code> since only a unit test for another sub-project <code>sub2</code> changed.
Instead, all the tests for the sub-project have been executed.
Since we have the cascading effect when we have cache misses, we need to find the task which caused the caching chain to fail.
This can easily be done by filtering for all cacheable tasks which have been executed and then select the first one.
In our case, it turns out that the tests for the sub-project <code>internal-testing</code> were executed even though there was no code change to this project.
We start the input property comparison in Gradle Enterprise and see that the property <code>classpath</code> changed. This means that some file on the runtime classpath actually did change.
Looking deeper into this, we actually see that the inputs for the task <code>processResources</code> changed in that project, too.
Finally, we find this in our build file:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">task currentVersionInfo(type: CurrentVersionInfo) {
    version = project.version
    versionInfoFile = new File(generatedResourcesDir, "currentVersion.properties")
}

sourceSets.main.output.dir generatedResourcesDir, builtBy: currentVersionInfo

class CurrentVersionInfo extends DefaultTask {
    @Input
    String version

    @OutputFile
    File versionInfoFile

    @TaskAction
    void writeVersionInfo() {
        def properties = new Properties()
        properties.setProperty("latestMilestone", version)
        versionInfoFile.withOutputStream { out -&gt;
            properties.store(out, null)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">val currentVersionInfo = tasks.create&lt;CurrentVersionInfo&gt;("currentVersionInfo") {
    version = project.version.toString()
    versionInfoFile = File(generatedResourcesDir, "currentVersion.properties")
}

sourceSets.main { output.dir(generatedResourcesDir, "builtBy" to currentVersionInfo) }

open class CurrentVersionInfo : DefaultTask() {
    @Input
    lateinit var version: String

    @OutputFile
    lateinit var versionInfoFile: File

    @TaskAction
    fun writeVersionInfo() {
        val properties = Properties()
        properties["latestMilestone"] = version
        versionInfoFile.outputStream().use { out -&gt;
            properties.store(out, null)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since properties files stored by Java&#8217;s <code>Properties.store</code> method contain a timestamp, this will cause a change to the runtime classpath every time the build runs.
In order to solve this problem see <a href="#volatile_outputs">"Non-repeatable task outputs"</a> or use <a href="#normalization">input normalization</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The compile classpath is not affected since compile avoidance ignores non-class files on the classpath.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common-problems"><a class="anchor" href="#common-problems"></a><a class="link" href="#common-problems">Solving common problems</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Small problems in a build, like forgetting to declare a configuration file as an input to your task, can be easily overlooked.
The configuration file might change infrequently, or only change when some other (correctly tracked) input changes as well.
The worst that could happen is that your task doesn&#8217;t execute when it should.
Developers can always re-run the build with <code>clean</code>, and "fix" their builds for the price of a slow rebuild.
In the end nobody gets blocked in their work, and the incident is chalked up to "Gradle acting up again."</p>
</div>
<div class="paragraph">
<p>With cacheable tasks incorrect results are stored permanently, and can come back to haunt you later; re-running with <code>clean</code> won&#8217;t help in this situation either. When using a shared cache, these problems even cross machine boundaries. In the example above, Gradle might end up loading a result for your task that was produced with a different configuration. Resolving these problems with the build therefore becomes even more important when task output caching is enabled.</p>
</div>
<div class="paragraph">
<p>Other issues with the build won&#8217;t cause it to produce incorrect results, but will lead to unnecessary cache misses.
In this chapter you will learn about some typical problems and ways to avoid them.
Fixing these issues will have the added benefit that your build will stop "acting up," and developers can forget about running builds with <code>clean</code> altogether.</p>
</div>
<div class="sect2">
<h3 id="system_file_encoding"><a class="anchor" href="#system_file_encoding"></a><a class="link" href="#system_file_encoding">System file encoding</a></h3>
<div class="paragraph">
<p>Most Java tools use the system file encoding when no specific encoding is specified.
This means that running the same build on machines with different file encoding can yield different outputs.
Currently Gradle only tracks on a per-task basis that no file encoding has been specified, but it does not track the system encoding of the JVM in use.
This can cause incorrect builds. You should always set the file system encoding to avoid these kind of problems.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Build scripts are compiled with the file encoding of the Gradle daemon.
By default, the daemon uses the system file encoding, too.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Setting the file encoding for the Gradle daemon mitigates both above problems by making sure that the encoding is the same across builds.
You can do so in your <code>gradle.properties</code>:</p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-properties" data-lang="properties">org.gradle.jvmargs=-Dfile.encoding=UTF-8</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="environment_variable_tracking"><a class="anchor" href="#environment_variable_tracking"></a><a class="link" href="#environment_variable_tracking">Environment variable tracking</a></h3>
<div class="paragraph">
<p>Gradle does not track changes in environment variables for tasks.
For example for <code>Test</code> tasks it is completely possible that the outcome depends on a few environment variables.
To ensure that only the right artifacts are re-used between builds, you need to add environment variables as inputs to tasks depending on them.</p>
</div>
<div class="paragraph">
<p>Absolute paths are often passed as environment variables, too.
You need to pay attention what you add as an input to the task in this case.
You would need to ensure that the absolute path is the same between machines. Most times it makes sense to track the file or the contents of the directory the absolute path points to.
If the absolute path represents a tool being used it probably makes sense to track the tool version as an input instead.</p>
</div>
<div class="paragraph">
<p>For example, if you are using tools in your <code>Test</code> task called <code>integTest</code> which depend on the contents of the <code>LANG</code> variable you should do this:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">integTest {
    inputs.property("langEnvironment") {
        System.getenv("LANG")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.getByName&lt;Test&gt;("integTest") {
    inputs.property("langEnvironment") {
        System.getenv("LANG")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you add conditional logic to distinguish CI builds from local development builds, you have to ensure that this does not break the loading of task outputs from CI onto developer machines.
For example, the following setup would break caching of <code>Test</code> tasks, since Gradle always detects the differences in custom task actions.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">if (System.getenv().containsKey("CI")) {
    tasks.withType(Test) {
        doFirst {
            println "Running test on CI"
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">if ("CI" in System.getenv()) {
    tasks.withType&lt;Test&gt; {
        doFirst {
            println("Running test on CI")
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should always add the action unconditionally:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">tasks.withType(Test) {
    doFirst {
        if (System.getenv().containsKey("CI")) {
            println "Running test on CI"
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.withType&lt;Test&gt; {
    doFirst {
        if ("CI" in System.getenv()) {
            println("Running test on CI")
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way, the task has the same custom action on CI and on developer builds and its outputs can be re-used if the remaining inputs are the same.</p>
</div>
</div>
<div class="sect2">
<h3 id="line_endings"><a class="anchor" href="#line_endings"></a><a class="link" href="#line_endings">Line endings</a></h3>
<div class="paragraph">
<p>If you are building on different operating systems be aware that some version control systems convert line endings on check-out.
For example, Git on Windows uses <code>autocrlf=true</code> by default which converts all line endings to <code>\r\n</code>.
As a consequence, compilation outputs can&#8217;t be re-used on Windows since the input sources are different.
If sharing the build cache across multiple operating systems is important in your environment, then setting <code>autocrlf=false</code> across your build machines is crucial for optimal build cache usage.</p>
</div>
</div>
<div class="sect2">
<h3 id="symbolic_links"><a class="anchor" href="#symbolic_links"></a><a class="link" href="#symbolic_links">Symbolic links</a></h3>
<div class="paragraph">
<p>When using symbolic links, Gradle does not store the link in the build cache but the actual file contents of the destination of the link.
As a consequence you might have a hard time when trying to reuse outputs which heavily use symbolic links.
There currently is no workaround for this behavior.</p>
</div>
<div class="paragraph">
<p>For operating systems supporting symbolic links, the content of the destination of the symbolic link will be added as an input.
If the operating system does not support symbolic links, the actual symbolic link file is added as an input.
Therefore, tasks which have symbolic links as input files, e.g. <code>Test</code> tasks having symbolic link as part of its runtime classpath, will not be cached between Windows and Linux.
If caching between operating systems is desired, symbolic links should not be checked into version control.</p>
</div>
</div>
<div class="sect2">
<h3 id="java_version_tracking"><a class="anchor" href="#java_version_tracking"></a><a class="link" href="#java_version_tracking">Java version tracking</a></h3>
<div class="paragraph">
<p>Gradle tracks only the major version of Java as an input for compilation and test execution.
Currently, it does <em>not</em> track the vendor nor the minor version.
Still, the vendor and the minor version may influence the bytecode produced by compilation.</p>
</div>
<div class="paragraph">
<p>If you use different JVM vendors for compiling or running Java we strongly suggest that you add the vendor as an input to the corresponding tasks.
This can be achieved by using the <a href="https://docs.gradle.org/5.4.1/userguide/more_about_tasks.html#sec:task_input_output_runtime_api">runtime API</a> as shown in the following snippet.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">tasks.withType(AbstractCompile) {
    inputs.property("java.vendor") {
        System.getProperty("java.vendor")
    }
}

tasks.withType(Test) {
    inputs.property("java.vendor") {
        System.getProperty("java.vendor")
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.withType&lt;AbstractCompile&gt; {
    inputs.property("java.vendor") {
        System.getProperty("java.vendor")
    }
}

tasks.withType&lt;Test&gt; {
    inputs.property("java.vendor") {
        System.getProperty("java.vendor")
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With respect to tracking the Java minor version there are different competing aspects: developers having cache hits and "perfect" results on CI.
There are basically two situations when you may want to track the minor version of Java: for compilation and for runtime.
In the case of compilation, there can sometimes be differences in the produced bytecode for different minor versions.
However, the bytecode should still result in the same runtime behavior.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://docs.gradle.org/5.4.1/userguide/java_plugin.html#sec:java_compile_avoidance">Java compile avoidance</a> will treat this bytecode the same since it extracts the ABI.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Treating the minor number as an input can decrease the likelihood of a cache hit for developer builds.
Depending on how standard development environments are across your team, it&#8217;s common for many different Java minor version to be in use.</p>
</div>
<div class="paragraph">
<p>Even without tracking the Java minor version you may have cache misses for developers due to some locally compiled class files which constitute an input to test execution.
If these outputs made it into the local build cache on this developers machine even a clean will not solve the situation.
Therefore, the choice for tracking the Java minor version is between sometimes or never re-using outputs between different Java minor versions for test execution.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The compiler infrastructure provided by the JVM used to run Gradle is also used by the Groovy compiler.
Therefore, you can expect differences in the bytecode of compiled Groovy classes for the same reasons as above and the same suggestions apply.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="avoid_changing_inputs_external_to_your_build"><a class="anchor" href="#avoid_changing_inputs_external_to_your_build"></a><a class="link" href="#avoid_changing_inputs_external_to_your_build">Avoid changing inputs external to your build</a></h3>
<div class="paragraph">
<p>If your build is dependent on external dependencies like binary artifacts or dynamic data from a web page you need to make sure that these inputs are consistent throughout your infrastructure.
Any variations across machines will result in cache misses.</p>
</div>
<div class="paragraph">
<p>Never re-release a non-changing binary dependency with the same version number but different contents: if this happens with a plugin dependency, you will never be able to explain why you don’t see cache reuse between machines (it’s because they have different versions of that artifact).</p>
</div>
<div class="paragraph">
<p>Using <code>SNAPSHOT</code>s or other changing dependencies in your build by design violates the <a href="#stable_task_inputs">stable task inputs</a> principle.
To use the build cache effectively, you should depend on fixed dependencies.
You may want to look into the <a href="https://github.com/nebula-plugins/gradle-dependency-lock-plugin">dependency lock plugin</a> or switch to using <a href="https://docs.gradle.org/5.4.1/userguide/composite_builds.html">composite builds</a> instead.</p>
</div>
<div class="paragraph">
<p>The same is true for depending on volatile external resources, for example a list of released versions.
One way of locking the changes would be to check the volatile resource into source control whenever it changes so that the builds only depend on the state in source control and not on the volatile resource itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="suggestions_for_authoring_your_build"><a class="anchor" href="#suggestions_for_authoring_your_build"></a><a class="link" href="#suggestions_for_authoring_your_build">Suggestions for authoring your build</a></h3>
<div class="sect3">
<h4 id="custom_actions"><a class="anchor" href="#custom_actions"></a><a class="link" href="#custom_actions">Review usages of <code>doFirst</code> and <code>doLast</code></a></h4>
<div class="paragraph">
<p>Using <code>doFirst</code> and <code>doLast</code> from a build script on a cacheable task ties you to build script changes since the implementation of the closure comes from the build script.
If possible, you should use separate tasks instead.</p>
</div>
<div class="paragraph">
<p>Modifying input or output properties via the runtime API in <code>doFirst</code> is discouraged since these changes will not be detected for up-to-date checks and the build cache.
Even worse, when the task does not execute, then the configuration of the task is actually different from when it executes.
Instead of using <code>doFirst</code> for modifying the inputs consider using a separate task to configure the task under question - a so called configure task.
E.g., instead of doing</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">jar {
    doFirst {
        manifest {
            def classPath = [':core', ':baseServices'].collect { project(it).jar.archivePath.name }.join(" ")
            attributes('Class-Path': classPath)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.jar {
    doFirst {
        manifest {
            val classPath = listOf(":core", ":baseServices").joinToString(" ") {
                project(it).tasks.getByName&lt;Jar&gt;("jar").archivePath.name
            }
            attributes("Class-Path" to classPath)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>do</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">task configureJar {
    doLast {
        jar.manifest {
            def classPath = [':core', ':baseServices'].collect { project(it).jar.archivePath.name }.join(" ")
            attributes('Class-Path': classPath)
        }
    }
}

jar.dependsOn(configureJar)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks {
    val configureJar = create("configureJar") {
        doLast {
            jar.get().manifest {
                val classPath = listOf(":core", ":baseServices").joinToString(" ") {
                    project(it).tasks.getByName&lt;Jar&gt;("jar").archivePath.name
                }
                attributes("Class-Path" to classPath)
            }
        }
    }
    jar { dependsOn(configureJar) }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="logic_based_on_task_outcome"><a class="anchor" href="#logic_based_on_task_outcome"></a><a class="link" href="#logic_based_on_task_outcome">Build logic based on the outcome of a task</a></h4>
<div class="paragraph">
<p>Do not base build logic on whether a task has been <em>executed</em>.
In particular you should not assume that the output of a task can only change if it actually executed.
Actually, loading the outputs from the build cache would also change them.
Instead of relying on custom logic to deal with changes to input or output files you should leverage Gradle&#8217;s built-in support by declaring the correct inputs and outputs for your tasks and leave it to Gradle to decide if the task actions should be executed.
For the very same reason using <code>outputs.upToDateWhen</code> is discouraged and should be replaced by properly declaring the task&#8217;s inputs.</p>
</div>
</div>
<div class="sect3">
<h4 id="overlapping_outputs"><a class="anchor" href="#overlapping_outputs"></a><a class="link" href="#overlapping_outputs">Overlapping outputs</a></h4>
<div class="paragraph">
<p>You already saw that overlapping outputs are a problem for task output caching in <a href="#concepts_overlapping_outputs">"The case against overlapping outputs"</a>.
When you add new tasks to your build or re-configure built-in tasks make sure you do not create overlapping outputs for cacheable tasks.
If you must you can add a <code>Sync</code> task which then would sync the merged outputs into the target directory while the original tasks remain cacheable.</p>
</div>
<div class="paragraph">
<p>Gradle Enterprise will show tasks where caching was disabled for overlapping outputs in the timeline and in the task input comparison:</p>
</div>
<div class="imageblock screenshot">
<div class="content">
<img src="images/overlapping-outputs-input-comparison.png" alt="overlapping outputs input comparison">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="achieving_stable_task_inputs"><a class="anchor" href="#achieving_stable_task_inputs"></a><a class="link" href="#achieving_stable_task_inputs">Achieving stable task inputs</a></h3>
<div class="paragraph">
<p>It is crucial to have <a href="#stable_task_inputs">stable task inputs</a> for every cacheable task.
In the following section you will learn about different situations which violate stable task inputs and look at possible solutions.</p>
</div>
<div class="sect3">
<h4 id="volatile_inputs"><a class="anchor" href="#volatile_inputs"></a><a class="link" href="#volatile_inputs">Volatile task inputs</a></h4>
<div class="paragraph">
<p>If you use a volatile input like a timestamp as an input property for a task, then there is nothing Gradle can do to make the task cacheable.
You should really think hard if the volatile data is really essential to the output or if it is only there for e.g. auditing purposes.</p>
</div>
<div class="paragraph">
<p>If the volatile input is essential to the output then you can try to make the task using the volatile input cheaper to execute.
You can do this by splitting the task into two tasks - the first task doing the expensive work which is cacheable and the second task adding the volatile data to the output.
In this way the output stays the same and the build cache can be used to avoid doing the expensive work.
For example, for building a jar file the expensive part - Java compilation - is already a different task while the jar task itself, which is not cacheable, is cheap.</p>
</div>
<div class="paragraph">
<p>If it is not an essential part of the output, then you should not declare it as an input.
As long as the volatile input does not influence the output then there is nothing else to do.
Most times though, the input will be part of the output.</p>
</div>
</div>
<div class="sect3">
<h4 id="volatile_outputs"><a class="anchor" href="#volatile_outputs"></a><a class="link" href="#volatile_outputs">Non-repeatable task outputs</a></h4>
<div class="paragraph">
<p>Having tasks which generate different outputs for the same inputs can pose a challenge for the effective use of task output caching as seen in <a href="#concepts_repeatable_task_outputs">"Repeatable task outputs"</a>.
If the non-repeatable task output is not used by any other task then the effect is very limited.
It basically means that loading the task from the cache might produce a different result than executing the same task locally.
If the only difference between the outputs is a timestamp, then you can either accept the effect of the build cache or decide that the task is not cacheable after all.</p>
</div>
<div class="paragraph">
<p>Non-repeatable task outputs lead to non-stable task inputs as soon as another task depends on the non-repeatable output.
For example, re-creating a jar file from the files with the same contents but different modification times yields a different jar file.
Any other task depending on this jar file as an input file cannot be loaded from the cache when the jar file is rebuilt locally.
This can lead to hard-to-diagnose cache misses when the consuming build is not a clean build or when a cacheable task depends on the output of a non-cacheable task.
For example, when doing incremental builds it is possible that the artifact on disk which is considered up-to-date and the artifact in the build cache are different even though they are essentially the same.
A task depending on this task output would then not be able to load outputs from the build cache since the inputs are not exactly the same.</p>
</div>
<div class="paragraph">
<p>As described in <a href="#stable_task_inputs">"Stable task inputs"</a> you can either make the task outputs repeatable or use input normalization.
You already learned about the possibilities with <a href="#filter_runtime_classpath">configurable input normalization</a>.</p>
</div>
<div class="paragraph">
<p>Gradle includes some support for creating repeatable output for archive tasks.
For tar and zip files Gradle can be configured to create <a href="https://docs.gradle.org/5.4.1/userguide/working_with_files.html#sec:reproducible_archives">reproducible archives</a>.
This is done by configuring e.g. the <code>Zip</code> task via the following snippet.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">task createZip(type: Zip) {
    preserveFileTimestamps = false
    reproducibleFileOrder = true
    // ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-kotlin" data-lang="kotlin">tasks.create&lt;Zip&gt;("createZip") {
    isPreserveFileTimestamps = false
    isReproducibleFileOrder = true
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way to make the outputs repeatable is to activate caching for a task with non-repeatable outputs.
If you can make sure that the same build cache is used for all builds then the task will always have the same outputs for the same inputs by design of the build cache.
Going down this road can lead to different problems with cache misses for incremental builds as described above.
Moreover, race conditions between different builds trying to store the same outputs in the build cache in parallel can lead to hard-to-diagnose cache misses.
If possible, you should avoid going down that route.</p>
</div>
</div>
<div class="sect3">
<h4 id="limit_the_effect_of_volatile_data"><a class="anchor" href="#limit_the_effect_of_volatile_data"></a><a class="link" href="#limit_the_effect_of_volatile_data">Limit the effect of volatile data</a></h4>
<div class="paragraph">
<p>If none of the described solutions for dealing with volatile data work for you, you should still be able to limit the effect of volatile data on effective use of the build cache.
This can be done by adding the volatile data later to the outputs as described in <a href="#volatile_inputs">"Volatile task inputs"</a>.
Another option would be to move the volatile data so it affects less tasks.
For example moving the dependency from the <code>compile</code> to the <code>runtime</code> configuration may already have quite an impact.</p>
</div>
<div class="paragraph">
<p>Sometimes it is also possible to build two artifacts, one containing the volatile data and another one containing a constant representation of the volatile data.
The non-volatile output would be used e.g. for testing while the volatile one would be published to an external repository.
While this conflicts with the Continuous Delivery "build artifacts once" principle it can sometimes be the only option.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom_and_third_party_tasks"><a class="anchor" href="#custom_and_third_party_tasks"></a><a class="link" href="#custom_and_third_party_tasks">Custom and third party tasks</a></h3>
<div class="paragraph">
<p>If your build contains custom or third party tasks, you should take special care that these don&#8217;t influence the effectiveness of the build cache.
Special care should also be taken for code generation tasks which may not have <a href="#concepts_repeatable_task_outputs">repeatable task outputs</a>.
This can happen if the code generator includes e.g. a timestamp in the generated files or depends on the order of the input files.
Other pitfalls can be the use of <code>HashMap</code>s or other data structures without order guarantees in the task&#8217;s code.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some third party plugins can even influence cacheability of Gradle&#8217;s built-in tasks.
This can happen if they add inputs like absolute paths or volatile data to tasks via the runtime API.
In the worst case this can lead to incorrect builds when the plugins try to depend on the <a href="#logic_based_on_task_outcome">outcome of a task</a> and do not take <code>FROM-CACHE</code> into account.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a><a class="link" href="#summary">Summary</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide has described the two ways Gradle can avoid work and the concepts which make up a build that effectively leverages task output caching.
You should now have the knowledge to adapt your own build so it can make effective use of the build cache.
By doing so, you will improve incremental build performance while having fast clean builds when using the build cache.
Remember, the best way to do work faster is to simply avoid work that doesn’t need doing.</p>
</div>
<div class="paragraph">
<p>Be aware that your journey does not end here.
You should invest into keeping your build well behaved and check manually or automatically that you are still making effective use of the build cache.</p>
</div>
<div class="paragraph">
<p>The Gradle team&#8217;s journey does not end here either.
They will continue improving the build cache and give you more tools to make your builds even faster.</p>
</div>
</div>
</div>
<div class="sect1 contribute">
<h2 id="help_improve_this_guide"><a class="anchor" href="#help_improve_this_guide"></a><a class="link" href="#help_improve_this_guide">Help improve this guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Have feedback or a question? Found a typo? Like all Gradle guides, help is just a GitHub issue away. Please add an issue or pull request to <a href="https://github.com/gradle-guides/using-build-cache/">gradle-guides/using-build-cache</a> and we&#8217;ll get back to you.</p>
</div>
</div>
</div>
</div>
    </div>
    <!-- end div class="chapter" -->
    <aside class="secondary-navigation"></aside>
</main>

<footer class="site-layout__footer site-footer" itemscope="itemscope" itemtype="https://schema.org/WPFooter">
    <nav class="site-footer__navigation" itemtype="https://schema.org/SiteNavigationElement">
        <section class="site-footer__links">
            <div class="site-footer__link-group">
                <header><strong>Docs</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://docs.gradle.org/current/userguide/userguide.html" itemprop="url">User Manual</a></li>
                    <li itemprop="name"><a href="https://docs.gradle.org/current/dsl/" itemprop="url">DSL Reference</a></li>
                    <li itemprop="name"><a href="https://docs.gradle.org/current/release-notes.html" itemprop="url">Release Notes</a></li>
                    <li itemprop="name"><a href="https://docs.gradle.org/current/javadoc/" itemprop="url">Javadoc</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>News</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://blog.gradle.org/" itemprop="url">Blog</a></li>
                    <li itemprop="name"><a href="https://newsletter.gradle.com/" itemprop="url">Newsletter</a></li>
                    <li itemprop="name"><a href="https://twitter.com/gradle" itemprop="url">Twitter</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>Products</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://gradle.com/build-scans" itemprop="url">Build Scans</a></li>
                    <li itemprop="name"><a href="https://gradle.com/build-cache" itemprop="url">Build Cache</a></li>
                    <li itemprop="name"><a href="https://gradle.com/enterprise/resources" itemprop="url">Enterprise Docs</a></li>
                </ul>
            </div>
            <div class="site-footer__link-group">
                <header><strong>Get Help</strong></header>
                <ul class="site-footer__links-list">
                    <li itemprop="name"><a href="https://discuss.gradle.org/c/help-discuss" itemprop="url">Forums</a></li>
                    <li itemprop="name"><a href="https://github.com/gradle/" itemprop="url">GitHub</a></li>
                    <li itemprop="name"><a href="https://gradle.org/training/" itemprop="url">Training</a></li>
                    <li itemprop="name"><a href="https://gradle.org/services/" itemprop="url">Services</a></li>
                </ul>
            </div>
        </section>
        <section class="site-footer__subscribe-newsletter" id="newsletter-form-container">
            <header class="newsletter-form__header"><h5>Stay <code>UP-TO-DATE</code> on new features and news</h5></header>
            <p class="disclaimer">By entering your email, you agree to our <a href="https://gradle.org/terms/">Terms</a> and <a href="https://gradle.org/privacy/">Privacy Policy</a>, including receipt of emails. You can unsubscribe at any time.</p>
            <div class="newsletter-form__container"><iframe id="newsletter-form-frame" src="https://go.gradle.com/l/68052/2018-09-07/bk6wml" style="display: block; width: 100%; border: 0;"></iframe></div>
        </section>
    </nav>
    <div class="site-footer-secondary">
        <div class="site-footer-secondary__contents">
            <div class="site-footer__copy">© <a href="https://gradle.com">Gradle Inc.</a>
                <time>2018</time>
                All rights reserved.
            </div>
            <div class="site-footer__logo"><a href="/">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40" class="logo-icon">
                    <g style="fill:none;opacity:0.7">
                        <g fill="#11272E">
                            <path d="M37.7 7.1C36.4 4.8 34 4 32.4 4 30.4 4 28.7 5.1 29 5.9 29.1 6 29.5 6.8 29.7 7.2 30 7.7 30.6 7.3 30.9 7.2 31.5 6.9 32.2 6.7 32.9 6.8 33.6 6.9 34.6 7.4 35.3 8.6 36.8 11.6 32.1 17.8 26.2 13.5 20.3 9.3 14.5 10.7 11.9 11.5 9.3 12.4 8.1 13.3 9.2 15.3 10.6 18 10.1 17.1 11.5 19.4 13.6 22.9 18.3 17.7 18.3 17.7 14.8 23 11.8 21.7 10.6 19.9 9.6 18.2 8.8 16.3 8.8 16.3 -0.1 19.5 2.3 33.6 2.3 33.6L6.7 33.6C7.9 28.4 11.9 28.6 12.6 33.6L15.9 33.6C18.9 23.5 26.4 33.6 26.4 33.6L30.8 33.6C29.6 26.7 33.3 24.5 35.6 20.5 37.9 16.4 40.1 11.5 37.7 7.1L37.7 7.1ZM26.3 20.5C24 19.7 24.9 17.3 24.9 17.3 24.9 17.3 26.9 18 29.6 18.9 29.5 19.6 28.1 21 26.3 20.5L26.3 20.5Z"></path>
                            <path d="M28.4 18.7C28.5 19.3 28 19.9 27.3 20 26.6 20.1 26 19.6 26 18.9 25.9 18.3 26.4 17.7 27.1 17.6 27.7 17.6 28.3 18 28.4 18.7"></path>
                            <path d="M37.7 7.1C36.4 4.8 34 4 32.4 4 30.4 4 28.7 5.1 29 5.9 29.1 6 29.5 6.8 29.7 7.2 30 7.7 30.6 7.3 30.9 7.2 31.5 6.9 32.2 6.7 32.9 6.8 33.6 6.9 34.6 7.4 35.3 8.6 36.8 11.6 32.1 17.8 26.2 13.5 20.3 9.3 14.5 10.7 11.9 11.5 9.3 12.4 8.1 13.3 9.2 15.3 10.6 18 10.1 17.1 11.5 19.4 13.6 22.9 18.3 17.7 18.3 17.7 14.8 23 11.8 21.7 10.6 19.9 9.6 18.2 8.8 16.3 8.8 16.3 -0.1 19.5 2.3 33.6 2.3 33.6L6.7 33.6C7.9 28.4 11.9 28.6 12.6 33.6L15.9 33.6C18.9 23.5 26.4 33.6 26.4 33.6L30.8 33.6C29.6 26.7 33.3 24.5 35.6 20.5 37.9 16.4 40.1 11.5 37.7 7.1L37.7 7.1ZM26.3 20.5C24 19.7 24.9 17.3 24.9 17.3 24.9 17.3 26.9 18 29.6 18.9 29.5 19.6 28.1 21 26.3 20.5L26.3 20.5Z"></path>
                            <path d="M28.4 18.7C28.5 19.3 28 19.9 27.3 20 26.6 20.1 26 19.6 26 18.9 25.9 18.3 26.4 17.7 27.1 17.6 27.7 17.6 28.3 18 28.4 18.7"></path>
                        </g>
                    </g>
                </svg>
            </a></div>
            <div class="site-footer-secondary__links">
                <a href="https://gradle.com/careers">Careers</a> |
                <a href="https://gradle.org/privacy">Privacy</a> |
                <a href="https://gradle.org/terms">Terms of Service</a> |
                <a href="https://gradle.org/contact/">Contact</a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
    // Polyfill Element.matches()
    if (!Element.prototype.matches) {
        Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
    }
    // Polyfill Element.closest()
    if (!Element.prototype.closest) {
        Element.prototype.closest = function(s) {
            var el = this;
            if (!document.documentElement.contains(el)) return null;
            do {
                if (typeof el.matches === "function" && el.matches(s)) return el;
                el = el.parentElement || el.parentNode;
            } while (el !== null);
            return null;
        };
    }
    [].forEach.call(document.querySelectorAll(".docs-navigation a[href$='"+ window.location.pathname +"']"), function(link) {
        // Add "active" to all links same as current URL
        link.classList.add("active");

        // Expand all parent navigation
        var parentListEl = link.closest("li");
        while (parentListEl !== null) {
            var dropDownEl = parentListEl.querySelector(".nav-dropdown");
            if (dropDownEl !== null) {
                dropDownEl.classList.add("expanded");
            }
            parentListEl = parentListEl.parentNode.closest("li");
        }
    });

    // Expand/contract multi-level side navigation
    [].forEach.call(document.querySelectorAll(".docs-navigation .nav-dropdown"), function registerSideNavActions(collapsibleElement) {
        collapsibleElement.addEventListener("click", function toggleExpandedSideNav(evt) {
            evt.preventDefault();
            evt.target.classList.toggle("expanded");
            evt.target.setAttribute("aria-expanded", evt.target.classList.contains("expanded").toString());
            return false;
        }, false);
    });
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>